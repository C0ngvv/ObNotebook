---
title: 2023-CCS-Firmulti Fuzzer
date: 2024/01/10
categories:
  - 论文
tags:
  - 论文翻译
---
# 2023-CCS-Firmulti Fuzzer
Firmulti Fuzzer: Discovering Multi-process Vulnerabilities in IoT Devices with Full System Emulation and VMI
![](2023-CCS-Firmulti%20Fuzzer/image-20240110110919415.png)



## 摘要
随着物联网设备的增长，物联网设备的数量和复杂性也在迅速增加。然而，许多物联网产品的开发没有充分考虑安全性，使它们容易被恶意软件利用。为了在恶意攻击者发现这些漏洞之前主动解决这些漏洞，信息安全研究人员使用静态和动态分析技术来识别漏洞并提出固件更新建议。

由于物联网固件架构的多样性，使用一般个人计算机直接在固件上进行模糊测试是具有挑战性的。作为一种解决方案，仿真技术通常用于创建用于漏洞检测的虚拟环境。然而，现有的基于仿真的模糊测试工具往往优先考虑效率，而避免利用全系统仿真。这些工具仅限于检测单个程序中的漏洞，并且无法识别跨多个进程交互产生的深层次漏洞。

为了解决这一挑战，我们提出了Firmulti Fuzzer，这是一个利用全系统仿真的模糊测试框架。在我们的方法中，我们进行了两次仿真。第一仿真利用现有仿真系统获取固件的完整系统仿真配置。接下来，第二个仿真使用具有虚拟机自省(VMI)功能的仿真器来监视整个系统环境。使用Firmulti Fuzzer，我们可以跟踪环境中所有程序的执行状态，并在检测到异常时生成通知，从而识别源自多个进程之间交互的漏洞。

实验证明了Firmulti Fuzzer在检测一般漏洞和多进程漏洞方面的有效性。最重要的是，Firmulti Fuzzer在识别多进程漏洞方面优于其他Fuzzer。Firmulti Fuzzer作为增强物联网设备安全性和减少恶意攻击者利用漏洞的工具，具有很大的潜力。

## 1.引言
各种物联网(IoT)设备变得越来越普遍。这些设备在家里、办公室甚至军事环境中随处可见，已经成为我们生活中不可或缺的一部分[2]。随着物联网设备的普及，其安全性变得不可或缺。然而，这些产品在制造中并未考虑安全问题[15]。成千上万的病毒形成了活跃在互联网上的僵尸网络。这些恶意软件利用物联网设备中的固件漏洞。例如，Mirai利用web服务中的错误或设备中的软件漏洞，这些漏洞可能成为攻击者感染设备的入口点[10,22]。因此，在恶意攻击者发现物联网设备的漏洞之前，检测并修补漏洞是非常重要的。

安全研究人员经常使用静态和动态分析技术来帮助识别漏洞，并向供应商提供更新以修补漏洞。与静态分析相比，动态分析的假阳性率更低[19]，模糊测试在动态分析领域尤为突出。模糊测试是一种软件测试技术，它不断地向目标程序提供随机输入，并检测崩溃或错误，从而使测试人员能够识别哪些输入是危险的，程序中的漏洞在哪里[14]。不幸的是，由于物联网固件的各种架构，不同的指令集和外设，通常很难直接使用标准个人计算机对物联网设备的固件进行模糊测试[27]。为了克服这些挑战，最简单和最直接的方法是在真实的物理设备上执行测试。如IoTFuzzer[5]或RPFuzzer[23]等。然而，物联网设备缺乏硬件资源，这使得大规模检测变得困难。此外，基于真实设备进行模糊测试时，由于整个过程是黑盒模糊，可能很难获得二进制文件，这将增加分析的难度[28]。

要解决前面提到的问题，最常见的方法是使用仿真技术构建虚拟环境，然后在虚拟设备上执行漏洞检测。Firmadyne和FirmAE是两个众所周知的固件仿真系统，它们可以自动对基于linux的固件进行全系统仿真，使动态分析能够在虚拟环境中执行，其行为与真实设备相似[4,18]。

最先进的研究\[Firm-AFL 30, EQUAFL 31]利用Firmadyne建立了一个虚拟环境进行模糊测试。为了提高模糊测试的效率，他们在开始模糊测试之前，从全系统仿真中获取系统信息后切换回用户模式。用户模式仿真意味着仿真器将固件中目标程序的指令集转换为可在普通计算机上执行的指令，而不是将整个固件环境虚拟化的完整系统仿真。尽管在用户模式下模糊测试提高了吞吐量，但我们仍然需要面对新的挑战。物联网设备必须包含一个或多个可执行文件来处理不同的任务，这可能会增加复杂的多进程交互;如果这些交互数据由用户控制，则设备可能存在潜在漏洞。一种常见的情况是web服务器与后端其他CGI程序通信，处理前端信息并完成请求[21,24]。攻击者可以利用web服务中的漏洞在本地写入文件，该文件可以被其他程序读取和使用，从而产生错误和危害[26]。目前使用用户模式仿真的模糊测试工具只能检测单个进程，这意味着它们只能关注目标进程的崩溃行为，而忽略由目标进程与一个或多个其他进程交互引起的崩溃。

为了解决上述挑战，直观的想法是使用全系统仿真进行模糊测试。但是，如果没有监控系统来观察虚拟环境中每个程序的执行状态，多进程的漏洞仍然无法被发现。例如，Firm-AFL[30]实现了FullAFL，这是一个全系统仿真模糊测试系统，利用Firmadyne获得全系统仿真虚拟环境并执行模糊测试。由于缺乏完整的监控系统，它只能检测单个程序中的漏洞。此外，CinfoFuzz使用远程调试工具进行全系统模糊测试[12]。但是，它缺乏系统级监控，只能从fork中检测目标进程及其子进程产生的漏洞，而不能检测整个系统。

为了解决这些挑战，我们提出了基于FullAFL的Firmulti Fuzzer。首先，它可以通过第一次仿真的分析过程，从任何现有的仿真系统中获得完整系统仿真所需的定制固件配置，这意味着我们可以保持这些仿真器的仿真成功率，避免经历Firmadyne的低成功率，并且可以替换为成功率更高的其他系统[7,8]。接下来，为了监视整个完整的系统环境，我们使用包含VMI作为系统环境监视器的模拟器执行第二个仿真。VMI是一种用于监视系统级虚拟机执行状态的技术。通过脚本事件跟踪虚拟机，我们可以在主机上监控虚拟机内部的信息，也可以向虚拟机发出请求，要求虚拟机执行相应的操作[16]，从而可以检测到多进程漏洞。在Firmulti Fuzzer完成第二次仿真后，主机可以通过VMI确认目标进程在虚拟环境中的执行情况，然后通过数据进行模糊测试。在模糊测试期间，Firmulti Fuzzer分析和监控与目标进程交互的所有其他进程。如果系统中发生崩溃，它将向模糊引擎发送警报，从而允许检测多个进程中的漏洞。

实验结果表明，Firmulti Fuzzer可以有效地检测到进程间的异常行为。此外，它还成功识别了5个已知漏洞，包括现实固件中的1个多进程漏洞。这表明Firmulti Fuzzer保持了其探索一般漏洞的能力，并且在检测多进程漏洞方面优于其他系统。

## 2.背景和相关工作
### 2.1 固件模拟
如第1节所述，通过仿真检测虚拟设备中的漏洞比在物理设备中更受欢迎。QEMU[1]是一个开源的硬件虚拟化工具，支持x86、x86-64、MIPS、ARM等常见的系统架构。它可以在虚拟环境中执行不同架构的程序。QEMU提供了两种仿真模式:用户模式和全系统模式。在用户模式下，将程序指令转换为主机可执行指令并执行。另一方面，全系统模式模拟完整的虚拟化环境。根据仿真模式的不同，保真度和性能也有所不同。然而，由于在QEMU中模拟具有不同设置的不同固件需要很高的手动水平，因此有大量的研究集中在自动仿真上。

基于linux的固件由内核和文件系统组成。通常，固件文件可以从供应商的网站上获得，但是在通用机器上运行内核需要针对虚拟机环境进行定制。最先进的自动化仿真系统[4,8,18]大多是从固件中提取内核，并将其替换为与模拟器兼容的内核。系统仿真过程涉及网络推断、污染分析和符号执行技术，以从外设向设备提供适当的设置和返回值。

还有一种固件叫做裸金属固件。它们直接在硬件上执行固件功能，而不是在操作系统上。对于这种类型的固件，也有许多研究可以帮助模拟[3,11,17,32]。裸机固件与操作系统无关，通常只包含一个主程序。这与本文在多进程环境中检测漏洞的目标不一致，因此，这些固件超出了范围。

上述工作使研究人员能够在不需要物理设备的情况下虚拟化特定设备。不幸的是，大多数现有系统都侧重于仿真，不能充分支持动态测试，或者在这方面缺乏完整的功能。

### 2.2 模糊测试
模糊测试是一种常用的软件测试技术，用于发现软件应用程序中的漏洞和安全弱点。它通过自动生成大量随机或半随机数据的测试输入来评估软件的鲁棒性和安全性。这些输入包含无效或不正确的值，例如格式错误、意外的数据类型或过长的输入。通过将应用程序置于各种不可预测的输入中，模糊测试允许测试人员识别可能在真实场景中出现的潜在缺陷和错误。

AFL (American Fuzzy Lop)[14]是一种广泛使用的模糊测试工具，以其优异的性能而闻名。它具有高度的自动化，利用优化的覆盖反馈机制和智能突变引擎来产生大量的输入。AFL因其识别编程错误、内存错误和安全漏洞的能力而受到安全研究人员的特别尊敬。

### 2.3 基于模拟的模糊测试
前面提到的AFL还提供了QEMU模式，允许用户在不同的架构上执行模糊测试。然而，由于物联网固件的硬件依赖性，在测试过程中，由于主机与测试程序的不兼容，往往会导致测试过程中出现意想不到的状态[31]。TriForceAFL[20]是基于AFL的QEMU模式。它被扩展到允许用户在内核上执行模糊测试。Firm-AFL和EQUAFL[30,31]通过在两种仿真模式之间切换，提高了模糊测试的效率，从而提高了模糊测试的吞吐量，增加了漏洞检测的机会。然而，这两个系统并没有解决多进程交互导致的漏洞检测问题。HOFF和ReLink[25,26]将动态数据流跟踪与模糊检测相结合，实现了多步漏洞检测。他们使用Strace作为监视器来记录用户可控制的环境设置或网络级别的内存段，并将它们合并到模糊输入队列中。虽然该系统包含一个监视器，但它不用于监视多进程。CinfoFuzz[12]允许对web服务进行模糊测试，它的动态和静态分析可以监控多进程中的崩溃。然而，多进程的监控仅限于目标进程及其子进程。如果进程之间通过文件访问等其他方式进行通信，系统仍然无法检测到漏洞。

> [12] Qi Feng and Weiyu Dong. 2022. CinfoFuzz: Fuzzing Method Based on Web
Service Correlation Information of Embedded Devices. In 10th IEEE International
Conference on Information, Communication and Networks (ICICN 2022). 242–249.
[25] Lei Yu, Linyu Li, Haoyu Wang, Xiaoyu Wang, Houhua He, and Xiaorui Gong. 2021.
Towards Automated Detection of Higher-Order Memory Corruption Vulnerabilities in Embedded Devices. In Design, Automation & Test in Europe Conference &
Exhibition (DATE 2021). 1707–1710.
[26] Lei Yu, Haoyu Wang, Linyu Li, and Houhua He. 2021. Towards Automated
Detection of Higher-Order Command Injection Vulnerabilities in IoT Devices:
Fuzzing With Dynamic Data Flow Analysis. International Journal of Digital Crime
and Forensics (IJDCF) 13, 6 (2021), 1–14.

### 2.4 其他多进程交互检测系统
SRFuzzer[29]通过在模糊处理之前分析数据包来提高模糊处理的效率。它利用ptrace作为设备中的系统监视器来检测进程间的崩溃。但是，SRFuzzer直接在物理设备上执行模糊测试，这使得它比基于仿真的方法具有更低的可扩展性。此外，使用ptrace需要固件已经包含该工具，或者需要单独安装该工具，这降低了系统的灵活性。Karonte[21]通过静态分析检测漏洞。系统在多个二进制文件中传播受污染的消息，并跟踪进程之间的通信，以识别不安全的交互。然而，Chen等[6]指出Karonte的假阳性率很高。它在网站的前端和后端使用关键字匹配来解决问题，但仍然出现误报。静态分析方法依赖于逆向工程研究人员的手工分析，这大大增加了漏洞识别的成本。

最后，我们整理了这些检测物联网设备漏洞的系统，并将其总结在表1中。

![](2023-CCS-Firmulti%20Fuzzer/image-20240110110721017.png)

## 3.方法
Firmulti Fuzzer进行如图1所示。它结合了各种技术，如仿真和模糊测试。以往的研究[30]成功地将全系统仿真与模糊测试相结合，但缺乏全面的系统监控。因此，我们提出了一个扩展框架，称为Firmulti Fuzzer。它可以分为三个阶段:第一次仿真、第二次仿真和模糊测试。在第一个仿真阶段，系统使用现有的完整系统仿真系统获取配置文件。第二个仿真阶段利用带有VMI的仿真器以及获取的配置文件。在第二次仿真之后，对系统环境进行监视，并使用VMI执行模糊测试。

![](2023-CCS-Firmulti%20Fuzzer/image-20240110111049905.png)

### 3.1 第一次仿真
为了实现检测多进程漏洞的目标，我们利用具有VMI功能的仿真器来模拟和监视整个系统。尽管如此，模拟不同的固件需要特定的设置，定制每个固件需要大量的手工工作。为了克服这个问题，我们使用现有的自动化仿真系统执行了第一个仿真。这些系统通常处理NVRAM、内核或网络设置，以获得适当的模拟器配置。如果仿真器也是基于qemu的，那么这些设置是高度兼容的。即使存在版本差异，通常也可以通过轻微的操作进行调整。因此，我们可以使用这些自动化仿真系统获得必要的系统配置。

在执行第一个仿真之前，有必要提供目标设备的固件文件。这些文件通常可以从供应商的官方网站或FTP站点获得。如果模拟成功，我们将获得固件映像和模拟启动脚本，其中包含设备的网络设置。该脚本由仿真系统自动生成，用户无需修改。相反，根据所使用的特定自动化仿真系统，仿真也可能失败。使用具有较高成功率的系统可以有效地避免失败，但确保第一次仿真的所有处理都可以应用到第二个仿真器是至关重要的。

### 3.2 第二次仿真和建立模糊测试
在完成第一个仿真之后，我们获得了仿真所需的固件映像和配置文件。然后，我们使用具有VMI功能的模拟器进行第二个仿真。在开始第二个仿真之前，提供模糊测试的设置非常重要，其中包括目标程序的名称、输入格式等。仿真完成，虚拟环境搭建完成后，系统开始为模糊测试过程做准备。模糊测试流程图如图2所示。

![](2023-CCS-Firmulti%20Fuzzer/image-20240110111317908.png)

在模糊测试初始化阶段，仿真器的监控模块“加载主模块”监视所有进程的创建行为，并将其名称与预定义的模糊测试目标程序进行比较。通常，考虑到恶意攻击者可能使用的攻击路径，目标程序通常是web服务，如httpd或lighttpd等。当然，我们的系统也支持对其他二进制文件进行模糊检测。一旦确定了目标程序，系统将通过VMI在虚拟环境中运行的程序和主机上运行的fuzzer之间建立连接。

为了确保测试目标程序的连续输入流，有必要设置一个分支服务器，在开始模糊测试过程之前，该服务器可以重复地派生目标程序的新实例。由于主机端的fuzzer和虚拟环境中的目标程序，无法直接启动分叉服务器。因此，我们利用VMI在目标程序到达预定的分叉地址时通知它，并记录当前的页表。分叉地址离模糊测试输入越近，模糊测试就越有效。如果您不确定在哪里接收输入，可以直接设置main函数的地址。记录的页表信息允许fuzzer启动fork服务器，它可以在完成或遇到异常时重新启动目标程序。页表的地址映射到主机地址，我们可以通过QEMU中的内存管理单元找到主机地址。完成分叉服务器的启动后，系统就可以进入模糊测试阶段了。

### 3.3 模糊测试和监控
在第二次仿真和模糊初始化完成后，系统将开始模糊测试。多进程的模糊处理流程如图3所示。我们已经维护了原始的面向覆盖率的模糊测试流程(图的左边)，但是我们已经添加了一个额外的步骤来检查不仅在目标程序中而且在其他进程中发生的异常。当检测到异常时，无论异常发生在哪个流程中，都会生成一个报告，并将触发异常的输入测试添加到突变池中。这种方法可以检测跨进程错误，同时保持对目标程序进行模糊测试的原始能力。

![](2023-CCS-Firmulti%20Fuzzer/image-20240110111705777.png)

对于输入测试的生成，系统根据目标程序的类型调整输入。例如，如果目标是HTTP服务器，则生成的输入将遵循数据包格式，而对于其他程序，将使用正常字符串。与前面关于分叉服务器的段落类似，数据需要从主机端传输到虚拟环境。VMI提供了一个读/写API，允许我们从给定的内存块或指针中读写数据并完成转换。此API简化了将输入传递给目标程序并从程序接收到模糊器的反馈的过程。它允许fuzzer获得与覆盖率相关的信息，指导它生成更有效的测试用例。

在模糊测试过程中，监控模块“Block Begin Callback”将检查程序中的异常。使用目标程序的汇编代码作为参考，该模块在每次进程进入一个新的基本块并检索当前CPU状态时被触发。每当触发事件发生时，系统通过比较当前PC地址和内核错误地址来检查进程是否遇到错误。每个体系结构的错误地址可能不同，可以通过在内核上使用逆向工程并事先设置它来获得。当检测到进程中出现异常时，系统会向fuzzer发送异常信号，并生成详细的错误报告。错误报告包括诸如导致错误的输入大小写、错误程序的名称及其PID等信息。这使研究人员能够轻松地重现错误并分析其潜在原因。

## 4.实现
### 4.1 概述
Firmulti Fuzzer建立在Firm-AFL的基础上，特别关注Firm-AFL的完整系统仿真方面。它跳过了Firm-AFL切换到用户模式并在完整系统仿真后直接开始模糊测试的部分。对系统的不同组件进行了各种修改，包括仿真、模糊测试和监控，下面将更详细地描述这些修改。

### 4.2 第一次仿真
最初的系统使用Firmadyne作为第一次仿真的仿真器。然而，Firmadyne经常遇到由于外设返回值不正确等问题而导致的故障，从而限制了可以测试的固件。为了提高仿真的成功率，我们在系统中加入了替代仿真器。通过修正仿真脚本并解决由QEMU版本变化引起的参数错误，成功集成了FirmAE和FirmSE等仿真器。根据仿真的有效性，用户可以为初始仿真阶段选择合适的仿真器。

### 4.3 第二次仿真
与Firm-AFL相同，我们使用DECAF[9]作为具有VMI功能的模拟器进行第二次仿真，并使用AFL作为模糊器。在Firmulti Fuzzer中，“加载主模块”功能是通过DECAF提供的VMI API VMI_register_callback实现的。当流程创建行为在环境中发生时，API提供回调函数触发器。通过在回调函数中确认流程的名称，它可以监视流程创建行为。此外，利用DECAF提供的VMI API DECAF_registerOptimizedBlockBeginCallback实现“BlockBeginCallback”模块。当任何进程进入一个新的基本块时，API会触发一个回调函数。通过在回调函数中标识当前运行进程的名称和执行地址，它可以监视虚拟环境中所有进程的执行状态。该模块还包括在这些进程中发生异常时将崩溃信息传递给fuzzer的函数。我们使用逆向工程工具Ghidra[13]来识别每个架构内核错误处理的地址，以检测进程错误。最后，除了原始的AFL错误报告之外，我们还通过修改DECAF实现了针对非目标进程异常的单独错误报告。

## 5.评估
### 5.1 研究问题
我们设计了以下研究问题来评估Firmulti Fuzzer在漏洞探测中的有效性:

- RQ1: Firmulti Fuzzer是否能有效检测进程间的异常行为?
- RQ2: Firmulti Fuzzer在整合了跨进程检测后，是否还能保持其探索一般漏洞的能力?
- RQ3: Firmulti Fuzzer的多进程漏洞探测能力与传统漏洞探测方法相比如何?

本文的所有实验环境均在AMD Ryzen 5 3600 6核CPU, 8GB RAM, Ubuntu 18.04操作系统上进行。Firmulti Fuzzer初始仿真使用的仿真器是FirmSE。

### 5.2 有效验证
为了解决RQ1问题，并证明Firmulti Fuzzer可以通过全系统仿真和系统级监控有效地检测进程中的异常行为，我们开发了两个测试程序，程序1和程序2，专门用于模糊测试。这两个程序利用Linux中的fifo文件作为它们之间的通信通道。程序1充当服务器，不断从客户机程序接收字符串。如果接收到的字符串以“bug”开头，服务器将崩溃。另一方面，程序2将输入转发给服务器程序，并且没有崩溃的因素。

![](2023-CCS-Firmulti%20Fuzzer/image-20240110112517051.png)

在固件中放置两个测试文件，并选择一个客户端测试程序作为模糊测试的目标。除了Firmulti Fuzzer之外，我们还禁用了Firmulti Fuzzer中的“Block Begin Callback”模块，将其作为普通Fuzzer，不进行系统级监控，并比较了两个系统的结果。

实验结果表明，Firmulti Fuzzer通过监控模块成功检测到服务器崩溃，发出警报，并生成错误报告。但是，没有系统监控的fuzzer无法检测到服务器的异常行为，因此无法识别任何错误，导致即使客户端没有任何漏洞，也没有任何错误报告。这证实Firmulti Fuzzer确实通过全系统仿真和系统级监控实现了跨进程异常行为检测。

### 5.3 真实固件漏洞测试
#### 5.3.1 通用模糊测试漏洞
对于RQ2，我们的目标是直接对真实世界的固件进行模糊测试，并识别目标程序中的漏洞。这是为了证明Firmulti Fuzzer在整合了检测跨进程异常行为的能力之后，仍然可以保持其检测一般漏洞的原始能力。实验重点是对固件或网络相关可执行文件的网络接口进行模糊测试。每个固件进行24小时测试，观察是否能够成功检测到指定的网络服务或程序崩溃，从而发现漏洞。在本实验中，使用Firm-AFL作为比较来评估其发现基本单进程漏洞的能力。表2给出了本实验中使用的固件数据集。

![](2023-CCS-Firmulti%20Fuzzer/image-20240110112717738.png)

表3显示了我们的实验结果。从表中可以看出，Firmulti Fuzzer在8个固件设备中成功检测到目标程序中的异常，包括4个已知的cve或EDB id，这表明即使增加了跨进程检测，Firmulti Fuzzer也保持了原有的检测能力。然而，与Firm-AFL相比，Firmulti Fuzzer仍有许多漏洞未能发现。这可能是由于全系统仿真造成的低效率的影响，详细原因将在6.2节中讨论。

![](2023-CCS-Firmulti%20Fuzzer/image-20240110112738625.png)


#### 5.3.2 多进程漏洞
对于RQ3，为了证明Firmulti Fuzzer的漏洞检测机制在检测多进程漏洞方面优于传统方法，我们也针对现实世界的固件进行了模糊测试。然后比较了两种漏洞检测方法的检测结果。使用的固件数据集和结果与RQ2相同，可以在表2和表3中查看。为了提高发现多进程漏洞的速度和概率，我们在模糊测试之前通过逆向工程将某些敏感短语纳入模糊器的关键字列表。

通过对华硕RT-N53固件的模糊测试，我们发现了一个已知漏洞CVE-2019-20082。此漏洞发生在特定网页的数据包中，如果将变量的值设置得太大，则会导致在固件内写入NVRAM时溢出。此溢出会在系统重新加载期间导致守护进程出错，从而导致系统崩溃。由于模糊测试的目标是web服务器，而崩溃程序驻留在系统的守护进程中，因此如果不使用完整的系统仿真和系统监控，则无法通过常规的模糊测试发现此漏洞。

## 6.讨论和未来工作
### 6.1 时间延迟导致报告不匹配
当系统检测到某个进程出现异常时，可能会产生错误的报告。错误流程如图4所示。在某些情况下，错误报告可能包括与异常对应的输入数据，但这些数据可能不准确。这种差异可以归因于输入测试数据和实际发生错误之间的时间延迟。当错误被触发时，模糊器可能已经转移到下一个测试数据，导致误解。虽然这在我们的评估实验中并不经常发生，但它更有可能发生在涉及多个程序之间交换数据的复杂漏洞中。

![](2023-CCS-Firmulti%20Fuzzer/image-20240110112951647.png)

目前，Firmulti Fuzzer需要额外的人工来解决这个问题。系统现在包含了一个功能，当遇到异常时记录最后100个输入测试数据。如果研究人员观察到输入数据未能重现漏洞，他们可以重放这些记录的数据，以确定导致错误的特定输入。

### 6.2 全系统仿真效率低下
在5.2节中进行的实验中，与使用混合仿真的Firm-AFL相比，仅依靠全系统仿真的Firmulti Fuzzer未能发现某些漏洞。模糊测试的随机性肯定会影响漏洞发现的结果。然而，差异背后的主要原因是完整的系统仿真需要构建完整的系统模型，包括各个组件之间的细节和交互。这个过程需要大量的资源和时间，对具有复杂功能的固件的影响尤其显著。然而，为了实现多进程漏洞检测，Firmulti Fuzzer不可避免地需要完整的系统仿真来帮助建立物联网设备环境。这种低效率大大降低了模糊吞吐量，从而延长了发现漏洞所需的时间。这不仅影响了目标程序的漏洞检测效率，也影响了多进程漏洞检测的有效性。

由于替换全系统仿真对于实现多进程漏洞检测是不切实际的，因此提高效率的更好方法包括增强模糊器。为设备设计更好的自定义突变机制和通过逆向工程技术获取更优的种子队列是提高漏洞发现概率的方向之一。

### 6.3 目标进程选择权衡
在Firmulti Fuzzer的测试框架中，我们预计模糊测试的入口点是在接收数据包或其他用户可控数据的web服务器上，然后通过系统级监控检测多进程类型的漏洞。另一种测试策略是使用静态分析或其他方法识别web服务器将与哪些进程交互，然后直接将模糊测试的目标进程更改为这些进程进行漏洞检测。

第二个测试工作流通过移除系统级监视器来捕获异常行为来提高效率，甚至可以通过用户模式进行模拟。然而，这种方法也有缺陷。首先，用户必须具备一定的分析能力，以找出web服务器将向哪些其他进程传输数据。由于有许多传输数据的方法，包括管道，插座，NVRAM等，这使得分析更加困难。此外，减少检测过程的范围以提高效率意味着在检测多进程漏洞时不可能检测到web服务器上的正常漏洞。

由于有许多因素可供选择，我们放弃了效率来提高检测覆盖率。更重要的是，它降低了Firmulti Fuzzer的使用门槛。即使用户有能力逆转这一过程，也可以使用6.2节中提到的方法来提高检测效率。

## 7.结论
本文提出了基于全系统仿真和虚拟机自省(VMI)技术的模糊测试框架Firmulti Fuzzer。它有效地检测多进程漏洞。

该系统利用现有的自动化全系统仿真器来获取仿真的配置，这些配置文件用于具有VMI功能的仿真器。通过VMI，系统实现了本地模糊器与虚拟环境中目标程序之间的通信，同时监控所有进程在模糊过程中的异常情况。

我们使用真实固件评估Firmulti Fuzzer。结果表明，Firmulti Fuzzer成功发现了5个已知漏洞，其中包括1个多进程型漏洞。这证实了Firmulti Fuzzer具有检测一般漏洞和多进程漏洞的能力。

## 参考链接

