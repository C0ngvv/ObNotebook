IEEE Transactions on Computer-Aided Design of Integrated Circuits and Systems，2020
CCF A

# 翻译
## 摘要
在新兴的应用场景中，嵌入式系统的互联性越来越强。这些应用程序中的许多都是安全关键型的，因此确保系统不受恶意攻击是重中之重。这项工作旨在检测漏洞，这些漏洞可能被攻击者利用来破坏嵌入式固件中的功能正确性，特别是由于缺乏源代码，这是具有挑战性的。

我们特别提出了EM-Fuzz，这是一种固件漏洞检测技术，它将模糊检测与实时内存检查紧密结合在一起。基于内存插桩的固件模糊测试，既可以通过传统的分支覆盖引导生成高质量的种子来探索难以到达的区域，也可以通过记录的内存敏感操作来持续尝试容易被攻击的敏感区域。更重要的是，该工具集成了实时内存检查器，以暴露内存漏洞，现有的没有源代码的fuzzers不支持这一点。在OpenSSL等实际嵌入式固件上的实验表明，EM-Fuzz显著提高了AFL和AFLFast等最先进的模糊测试工具的性能，覆盖率分别提高了93.98%和46.89%。此外，EM-Fuzz总共暴露了23个漏洞，平均每个漏洞约7小时。AFL和AFLFast总共发现了10个漏洞，平均每个漏洞花费的时间分别为13小时和10小时。在这23个漏洞中，有16个以前是未知的，并已报告给上游产品供应商，其中7个已在美国国家漏洞数据库中分配了唯一的CVE标识符。

索引术语-嵌入式固件，引导模糊测试，内存检查，漏洞。

## 1.引言
随着5G及以后技术的发展，嵌入式系统的连通性将在高度自动化车辆、家用机器人和工业4.0等新兴应用场景中变得越来越强。这些应用程序通常是安全关键型的，严格要求功能正确。因此，需要确保系统不受恶意代码注入、拒绝服务(DoS)等恶意攻击。然而现实是残酷的。Cui等[1]扫描了网络上约400万台嵌入式设备，发现其漏洞率为13.81%。这项工作的目标是嵌入式固件，漏洞检测是具有挑战性的，特别是由于缺乏源代码。

为了增强漏洞暴露能力，模糊测试成为近年来固件测试的研究热点[2]，[3]，[4]。Peach[2]是一个半自动的跨平台模糊测试框架，它根据人工构建的输入规范生成测试输入。SRFuzzer[3]是一个全自动模糊测试框架，用于对物理SOHO(小型办公室/家庭办公室)路由器的web服务器进行模糊测试。IoTFuzzer[4]使用移动应用程序的程序逻辑来生成探测目标固件的有意义的测试用例。尽管这些方法确保了报告漏洞的真实性，但它们属于不考虑执行反馈的黑盒模糊测试技术。因此，漏洞发现的效率并不令人满意。

灰盒模糊测试技术在带有源代码的程序上显示了有效的漏洞发现能力，因此首先想到的是使用QEMU进程仿真在嵌入式固件上执行类似的灰盒模糊测试。在没有嵌入式设备的情况下，QEMU仿真器确实成为模糊测试固件的首选，因为它具有相对完整的跨架构仿真能力，并且支持插桩来反馈分支覆盖信息。工具的二进制版本，如AFL[5]和AFLFast[6]，就是这种实现的代表，使用分支覆盖来连续地指导测试输入的生成。然而，我们在实践中发现，它们处理嵌入式固件的能力受到了极大的损害。有两个主要原因阻碍了这些工具在嵌入式场景中的使用。

一个原因是，与使用源代码模糊目标相比，使用QEMU仿真器模糊固件的时间成本更高，并且在单位时间内可以执行的测试用例数量(也称为吞吐量)要低3 - 5倍。虽然现有的fuzzers[5]，[6]可以应用于嵌入式固件，但它们面对低吞吐量的能力受到不适当的突变频率的限制。例如，AFL的盲突变策略难以使有意义的种子突变以有效到达难以到达的区域，从而导致被测目标的崩溃。

另一个原因是，当固件源代码不可用时，现有的fuzzers无法实现可以与各种杀毒程序(例如，AddressSanitizer, ThreadSanitizer)结合使用的源代码插桩来检查内存损坏。根据NVD近三年的统计，至少9.82%的被纳入漏洞与内存漏洞有关，如use-after-free、buffer overflow等。这使得固件中隐藏的内存漏洞不太可能被无助的fuzzer检测到。虽然MemCheck[7]、Dr. memory[8]等成熟的内存检查器通过二进制检测在二进制内存漏洞检查领域占据主导地位，但它们在固件上有较大的局限性。它们是可行的，前提是它们可以安装在与被测二进制文件相同的运行环境中(例如，相同的CPU架构)。在已经发布的固件中安装这些内存检查器是不切实际的，因此它们基本上不能与固件一起工作。此外，即使它们包含在固件中，在没有指导模糊测试的情况下执行任意测试用例可能会很耗时，并且根本不会报告漏洞。