---
title: 2023-CCS-Poster_Combining Fuzzing with Concolic Exection for IoT Frimware Testing
date: 2024/01/05
categories:
  - 论文
tags:
  - 论文翻译
---
# 2023-CCS-Poster_Combining Fuzzing with Concolic Exection for IoT Frimware Testing
## 摘要
物联网设备的供应逐年增加。即使在无人驾驶、建筑、机器人等需要复杂技术的行业，也正在使用物联网设备。然而，物联网设备的安全性由于其不同类型和具有挑战性的固件执行环境而落后于这一发展。现有的方法，如直接设备连接或部分仿真，都是用来解决这个问题的。但是，全系统仿真更适合大规模分析，因为它可以在不需要设备的情况下测试许多固件。因此，最近的研究将仿真和模糊测试等软件测试技术相结合，但仍然不适合测试各种固件，效率低下。在这个poster中，我们提出了FirmColic，它结合了模糊测试和concolic执行来减轻这些限制。FirmColic是一种增强进程仿真，它利用基于concolic执行的关键字提取提高了模糊测试的有效性。此外，为了提高仿真的成功率，我们在增强过程仿真环境中应用了五种仲裁技术。我们证明了与之前的研究相比，FirmColic具有更快的检测、更多的崩溃检测和更高的代码覆盖率。
## 1.引言
多年来，我们几乎在生活的各个方面都遇到了各种各样的物联网(IoT)设备。物联网设备不仅在数量上得到改善，而且在质量上也得到改善，因此它们可以应用于复杂的行业，如建筑和机器人行业。然而，由于制造商之间对这些技术的激烈竞争，物联网设备的安全性并没有得到太大改善。这些多样化的目标和宽松的安全条件是最理想的情况，这使得它们很容易成为攻击者的目标。最近的研究旨在在广泛的物联网设备上自动测试固件，其中一项研究将以前在软件中成功的测试技术应用于固件。一个典型的例子是Firm-AFL[8]，它是一个将基于QEMU[1]的自动仿真框架(称为Firmadyne[2])与覆盖引导的灰盒模糊工具(称为AFL, American Fuzzy Lop)相结合的系统。Firm-AFL弥补了仿真不稳定和吞吐量的不足。此外，它将AFL与仿真环境中的固件连接起来，从而可以对固件web应用程序的模糊测试技术进行测试。

然而，它们的仿真成功率非常低，因为大多数物联网固件的fuzzers使用QEMU，这与少数固件兼容。此外，web应用模糊测试具有固定的输入格式，因此现有的模糊测试有时在生成输入时效率不高，为了弥补这一点，通过手动分析提取关键字是不可避免的。为了克服这些限制，我们提出了FirmColic，它将concolic执行与物联网固件测试的fuzzer相结合。该方法可以解决复杂的路径约束问题，并将路径约束作为关键字自动求解固件的web应用程序二进制文件。此外，为了改善以前仿真的低成功率，我们将FirmAE[3]中的五种仲裁技术应用于我们的系统，这是最近发布的仿真研究之一。最后，我们提出了一个Ghidra[4]处理程序，以便对在concolic执行中不支持的体系结构进行程序分析。

## 2.IoT固件模糊测试
物联网设备在有限的条件和资源下完成预设的任务。物联网设备有软件、硬件和固件，可以实现它们的交互和通信。由于其控制物联网设备的作用，固件面临着远程攻击的威胁。尽管存在这些风险，但固件的源代码并没有分发，这对发布后的产品构成了威胁，因为没有对固件进行深入的安全检查。因此，由于缺少源代码和固件的多样性，我们需要在仿真环境中分析固件。在最近的研究中，仿真技术可以分为四大类:用户模式仿真、系统模式仿真、unicorn引擎和增强过程仿真。每种仿真技术都有其局限性。例如，RSFuzzer[7]中使用的独角兽引擎缺乏对中断的支持，用户模式仿真不模拟硬件应用程序编程接口(API)，系统模式仿真会导致进程开销。为了克服这些限制，Firm-AFL中引入的扩展进程模拟通常在用户模式模拟中执行，然后在遇到不可处理的系统调用时更改系统模式模拟。然而，由于低仿真成功率和模糊输入处理的可能问题，增强过程仿真也不稳定，因为它基于较少处理的QEMU。

在这个Poster中，我们提出了一个应用增强进程仿真的系统，旨在使用FirmAE的五种仲裁技术来提高仿真成功率，从而实现相对稳定的仿真环境。

## FirmColic 概述
我们提出了FirmColic，一个高仿真成功率和使用关键字提取实现快速覆盖率增长的系统。FirmColic的概述如图1所示。FirmColic以固件二进制文件作为输入。然后，如第2节所述，它将应用两种仿真技术来增强进程仿真，包括用户模式和系统模式仿真。此外，它还基于concolic执行对目标程序进行关键字提取。最后，在模糊测试开始时，将提取的关键字传递给模糊器，模糊器根据传递的关键字生成测试用例，并在用户模式仿真中尝试将它们发送到目标程序进行模糊测试。我们详细描述每一步如下。
![](2023-CCS-Poster_Combining%20Fuzzing%20with%20Concolic%20Exection%20for%20IoT%20Frimware%20Testing/image-20240105154735387.png)

**系统模式仿真**。现有的全系统仿真系统以完全匹配实际物理环境为目标。然而，来自不同厂商的固件类型的多样性使得在大规模分析中很难达到较高的仿真成功率。这个问题只能通过完全模拟所有物理设备来解决，这实际上是不可能的。对于许多固件的动态分析测试，通过一些操作来调整仿真环境比精确地模拟物理设备的行为更有效。Mingeun等[3]认为仿真成功率低的原因有五个，包括boot、网络、NVRAM、内核等问题。为了解决这个问题，我们对每个问题应用了称为仲裁技术的优化启发式技术，将现有研究Firmadyne的仿真成功率提高了16.28%至79.36%。对于我们的动态和静态分析系统，我们在系统模式仿真中通过仲裁技术实现了一些干预，并实现了与AFL的自动化交互。

**用户模式仿真**。通过快速转换系统调用，用户模式仿真使为一个中央处理单元(CPU)编译的进程能够在另一个CPU上高速运行。这种仿真比系统模式仿真快，因此它直接与模糊器通信。用户模式模拟不模拟外设以获得更快的速度，它将无法处理的系统调用传递给系统模式模拟。它还维护状态，以便模糊器可以从目标程序的每个输入的入口状态运行。最后，监控引擎检查程序代码覆盖率和在fuzzer运行期间由输入引起的崩溃。

**关键字提取**。模糊器可以将模糊过程中的关键字作为生成测试用例的重要参考。这在web API模糊测试中尤其重要，因为输入格式具有一定程度的固定性。在以前的研究中，如Firm-AFL，关键词是通过人工分析收集的，然后传递给模糊器。然而，这种方法受到分析人员能力的影响，需要付出很大的努力。有时，收集的关键字对于增加的代码覆盖率和崩溃检测来说可能毫无意义。为了缓解存在的问题，本系统对关键词抽取采用了concolic执行的方式。concolic执行通常用于解决难于通过程序路径的约束。换句话说，我们可以收集可以访问和传递程序路径的关键字。我们使用Angr[6]作为colcolic执行工具，但是Angr对MIPS和ARM的支持有限，而MIPS和ARM是一种流行的固件架构。FUZZWARE[5]是一个使用Angr将符号执行应用于物联网固件模糊测试的系统，也只支持ARM Cortex-M。我们将Ghidra与Angr集成在一起，以克服阻碍concolic执行的架构限制。它可以分析Angr无法分析的目标程序的寄存器和内存映射，因为Ghidra已经支持大多数MIPS和ARM体系结构，并且很容易扩展到不支持的体系结构。当对所有程序路径执行concolic执行时，收集到的关键字被发送到fuzzer。

**Fuzzer**。当仿真环境被激活，关键字提取步骤结束时，Fuzzer根据提取的关键字生成输入值。基于提取的关键字的测试用例示例如图2所示。带有部分插入的提取关键字的生成的和变异的测试用例被重复地发送到用户模式模拟器，这是目标程序运行的环境。创建的测试用例如果增加了目标程序的代码覆盖率，那么它就被放置在队列中并且进行变异。我们的系统原型使用AFL，但为了突变效率和吞吐量使用其它的模糊器替换它也可以用于未来的研究。

![](2023-CCS-Poster_Combining%20Fuzzing%20with%20Concolic%20Exection%20for%20IoT%20Frimware%20Testing/image-20240105160157807.png)

## 4.评估
我们通过将其与之前的系统Firm-AFL进行比较来评估FirmColic的性能。我们在24小时内模糊了所有的目标程序，并以3次试验的平均值来测量结果。我们用于评估的台式电脑拥有英特尔i7处理器，32GB内存，Ubuntu 18.04 LTS和AFL版本25.2 b。

为了评估我们的系统，我们将崩溃时间(TC)、总路径(TP)和唯一崩溃(UC)与Firm-AFL进行了比较。我们的实验结果见表1。实验目标是来自流行供应商的路由器和IP摄像机固件，如Dlink、TP-Link和Netgear。在“崩溃时间”实验中，我们只计算第一次发现1天或n天漏洞的时间，而忽略了误报的崩溃检测。在Total-of-Paths的情况下，我们无法测量代码覆盖率，因为我们的目标是固件文件系统中的二进制文件，而不是源文件。因此，我们使用Total-of-Paths作为覆盖率测量的代理。在表1中，我们可以看到大多数FirmColic的tc与Firm-AFL的tc相似或短得多。此外，研究表明，与Firm-AFL相比，FirmColic检测到的TP和UC最多可达3倍。最后，Firm-AFL未能模拟两个目标固件，但FirmColic通过优化仲裁技术成功进行了仿真和分析，这表明它比以前的系统提供了更好的仿真环境。

![](2023-CCS-Poster_Combining%20Fuzzing%20with%20Concolic%20Exection%20for%20IoT%20Frimware%20Testing/image-20240105160648249.png)

综上所述，FirmColic在TC、TP和UC方面的模糊性能优于Firm-AFL，并且它与Firm-AFL未模拟的固件兼容。随着目标数量的增加，仿真成功的好处预计也会增加。

## 5.结论与未来工作
在这张海报中，我们提出了FirmColic，这是一个将模糊测试和concolic执行相结合的框架，用于物联网固件测试。本系统采用了五种仲裁技术来提高仿真成功率。此外，我们还通过concolic执行从目标中提取关键字来提高模糊化效率。我们证明，与之前的系统Firm-AFL相比，FirmColic检测崩溃的速度更快，覆盖的路径更多。然而，concolic执行步骤可能非常耗时，从而导致更高的开销。此外，一些提取的关键字可能是多余的。为了克服这些限制，我们计划研究如何只提取有意义的关键字，而不是所有的关键字。

## 评价
这篇论文...，仿真是FirmAFL的增强进程仿真的方法，只不过将FirmAE的仲裁技术应用了进来。所谓的使用concolic和模糊测试相结合，是利用concolic提取字符串关键字，然后传递给fuzzing，并不是fuzzing过程中通过concolic实现更高覆盖率。

## 参考链接

