# 翻译

## 摘要

在跨域网络中，路由泄漏会导致Internet流量中断，并造成大规模的网络中断。为了准确检测路由泄漏，需要共享AS业务关系信息。但是，ase之间的业务关系信息是保密的。ase通常不愿意将这些信息透露给其他ase，尤其是它们的竞争对手。在本文中，我们提出了一种名为FL-RLD的方法，通过使用基于区块链的联邦学习框架来检测路由泄漏，同时维护ase之间业务关系的隐私，其中ase可以协作训练全局检测模型，而无需直接披露其特定的业务关系。为了缓解路由泄漏中缺乏真实验证数据的问题，FL-RLD提供了一种通过标记本地路由策略的AS三元组来进行自我验证的方案。我们评估了多种数据集下的FL-RLD，包括不平衡数据集和平衡数据集，并研究了不同拓扑下FL-RLD的不同部署策略。结果表明，无论数据集是均衡的还是不均衡的，FL-RLD检测路由泄漏的性能都优于单个AS检测。此外，结果表明，选择具有最多对等体的as来首次部署FL-RLD，在检测路由泄漏方面比选择具有最多提供者和客户的as带来更大的好处。

关键字：BGP安全，路由泄漏检测，联邦学习

## 1.引言

BGP (Border Gateway Protocol)是域间网络中用于自治系统(ASes)之间交换路由信息的协议。在BGP中，每个自治系统根据自己的路由策略选择最佳路由，并将选择的路由发布给邻居。与域内网络中的最短路径路由策略不同，域间网络中的路由策略更为复杂，因为它考虑了AS之间的业务关系，其中业务关系根据AS的经济因素可以分为两种类型:c2p (customer-to-provider)和p2p (peer-to-peer)。

域间路由策略在许多研究中得到了广泛的研究，如[2,9,11]。他们的分析表明，最常采用的政策是无谷规则（valley-free rule）[23]。在无谷规则中，从提供商或对等体学到的路由不应该导出到其他提供商或对等体。然而，由于错误配置和恶意攻击，路由公告可能会在违反双方商定的路由策略的情况下传播，这种情况被定义为路由泄漏[8,44]。

路由泄漏可以通过重定向流量导致重大中断，并带来遇到中间人攻击的风险[13]。例如，2015年3月12日，印度一家宽带提供商(AS17488)错误地向其提供商AS9498公布了300多个谷歌前缀，导致其用户无法访问谷歌的许多服务[28]。另一起事件发生在2021年2月11日，墨西哥的AS28548向其邻国泄露了2000多个前缀，影响了全球约80个国家[39]。由于严重的路由泄漏报告越来越多，路由泄漏检测变得越来越重要。

由于AS业务关系的保密性，检测路由泄漏是相当具有挑战性的。每个自治系统只知道自己和邻居之间的关系，但由于隐私问题，它不知道其他自治系统的确切关系。为了检测路由泄漏，一些研究[16,17,27,37]侧重于推断AS业务关系。然而，他们的推理技术在部分关键环节上仍然存在错误[17]。根据[35]的结果，在推断对等关系时，推理的精度可能会下降1425%。[5,8,12]等研究没有很好地考虑AS关系的隐私性，要求部署者直接披露AS关系信息，使得部署难以进行。

路由泄漏检测的另一个挑战是缺乏地面真值验证数据。只有少数破坏性路由泄漏事件得到了验证和报告。与客户感知服务(如多媒体服务)无关或不会导致严重中断的路由泄漏很难被发现和验证。例如，S. Abd等人[1]表明，在2006年至2018年期间，只有13起路由泄漏事件得到了验证。地面真值验证数据的缺乏使得传统机器学习技术等流行技术难以用于路由泄漏检测，因为它们通常需要大量具有高精度标签的训练数据来学习路由泄漏的重要特征。

联邦学习是一种分布式机器学习方法，它允许参与者协作训练模型，而无需将本地训练数据传输到中央服务器。每个参与者都可以使用他们的本地数据来训练一个本地模型。联邦学习不是对参与者的局部训练数据进行聚合，而是对参与者的局部模型更新进行聚合，可以保护参与者的数据隐私。然而，传统的联邦学习方法需要第三方服务器来聚合模型更新，这很容易出现单点故障。为了避免这个问题，提出了基于区块链的联邦学习框架[14,26,29,38]，该框架是去中心化的，将区块链的优势(例如区块链上的数据是不可变和可追溯的)与联邦学习的隐私保护技术相结合。

在本文中，我们提出了一种使用基于区块链的联邦学习框架进行路由泄漏检测的方法，即FL-RLD(基于区块链的路由泄漏检测联邦学习)。由于有大量的研究集中在解决区块链技术的安全性和效率[24]，我们主要考虑框架中联邦路由泄漏检测部分的设计。如前所述，一个自治系统具有有限的As业务关系信息，而路由泄漏检测则需要尽可能多的关系信息。通过使用联邦学习，AI可以通过共享模型更新而不是直接与其他人共享业务关系来协作训练模型以识别路由泄漏。此外，为了加强关系信息的隐私保护，我们建议用AS三元组代替业务关系来训练模型。通过使用本地路由策略将AS三元组标记为恶意或常规，我们的方法为路由泄漏中缺乏真实验证数据提供了解决方案。

在该方法中，首先，AS参与者使用已知的路由策略生成本地训练数据。本地训练数据由AS三元组和表示它们是否恶意的标签组成。然后，每个AS参与者使用其本地训练数据来训练本地模型，并通过区块链网络与其他参与者交换本地模型更新。在参与者的每一轮全局通信中，每个参与者将收集其他参与者的所有本地模型更新并将这些更新进行汇总。聚合的全局更新在区块链共识期间由参与者验证。在全局训练完成后，最终的全局模型更新存储在区块链中。AS参与者可以从区块链中检索全局模型更新，并利用它进行进一步的路由泄漏检测。

本文的贡献总结如下:
- 我们考虑了路由泄漏检测问题，并提出了一种通过AS三元组共享路由策略信息的隐私保护方法，而不是直接共享AS之间的业务关系。
- 我们定制了一个基于区块链的联邦学习框架，以学习域间网络中的路由策略，并协同训练一个模型来准确检测路由泄漏。
- 我们在不同的数据集上评估了所提出的方法，并分析了该方法在不同拓扑下的不同部署策略。结果表明，该方法可以提高单个自治系统检测路由泄漏的性能。结果还表明，部署具有最多对等体的as比部署具有最多提供者或客户的as更有助于检测路由泄漏。

本文的其余部分组织如下。第2节概述了路由泄漏的定义和检测路由泄漏的相关工作。在第3节中，我们介绍了路由泄漏检测问题和提出的解决方案。第4节介绍了所进行的实验和结果分析。第五部分是本文的结论。

## 2.背景及相关工作
在本节中，我们将概述路由泄漏的定义和检测路由泄漏的相关工作。

### 2.1 路由泄露
RFC 7908[44]中定义的路由泄漏分为六种类型。类型1:多宿主AS(有多个提供者)将从一个提供者学到的路由泄露给另一个上游提供者。类型2:AS将从一个对等体学到的路由泄露给另一个对等体。类型3:一个自治系统将从它的提供者学到的路由泄露给它的对等体。类型4:自治系统将从对等体学到的路由泄露给它的提供者。类型5:多归属自治系统将从一个上游ISP学到的路由作为源路由发布到另一个上游ISP。类型6:自治系统将其内部路由泄露给它的提供者或对等体。

Type 5和Type 6泄漏与起源前缀劫持更相关，可以通过路由起源验证(ROV)技术检测，如资源公钥基础设施(RPKI)[22]。RPKI可以构建一个可信任的存储库，用于验证前缀和原始ASN的所有权证书。类型1、类型2、类型3和类型4泄漏主要按ASes业务关系分组。图1展示了这四种类型的路由泄漏的简单示例，其中P是宣布路由。在本文中，我们主要关注类型1到类型4泄漏的检测。

![](images/Pasted%20image%2020230611105304.png)

### 2.2 路由泄露检测
Internet路由注册中心(IRRs)是公共分布式数据库，允许应用服务器注册和共享它们的路由策略。使用IRR中的信息，应用服务器可以检测违反路由策略的路由泄漏。然而，IRR数据库由不同的区域互联网注册管理机构(RIRs)或私人组织管理[30]，这对信息的同步和一致性提出了挑战。

RLP (route -leak Protection)[43]在BGP update消息中增加了一个新的BGP团体属性Down-only，用于检测和缓解路由泄漏。当接收到一条新路由时，会检查该路由的Down-only团体的值，以决定是否将该路由转发给上游提供商/对等体。如果该路由来自客户或对等as，而团体没有向上游as转发，则将该路由标记为路由泄漏。然而，在路由传播过程中，BGP团体的错误配置和Down-only团体的恶意修改或丢弃很容易影响RLP的性能[15]。

Li等[23]通过分析本地路由信息，得出了路由环路与路由泄漏之间的关系，并提出了一种检测路由泄漏的算法。但是，只有部分路由泄漏会导致路由环路。因此，它只能检测到部分路由泄漏。与[23]类似，Siddiqui等人[40]也开发了检测路由泄漏的理论框架。然而，该检测方法在路由泄漏初始化时有效，并不适合检测路由泄漏传播[40]。

对等锁定[41,42]是一种可部署的路由泄漏防御解决方案。它有两种ASes:保护者AS和受保护AS。如果路由经过受保护AS，但不是直接从受保护AS或其授权的上游AS到达，则保护AS将丢弃这些路由。然而，每个保护器和被保护对必须手动配置，缺乏有效的自动化方法[30]。

自治系统提供者授权(Autonomous System Provider Authorization, ASPA)[3]的核心思想类似于对等锁定。不同之处在于，ASPA基于RPKI，并向RPKI存储库添加了一种新类型的对象。新增对象包括下游自治系统和授权的上游自治系统。授权的上游自治系统可以传播下游自治系统的公告。通过验证对的证书，可以检测路由泄漏。然而，ASPA依赖于RPKI，而RPKI存在部署缓慢和由于发布roa不佳而导致的断开等问题[10]，这可能会影响ASPA的检测有效性。此外，在RPKI存储库中公开披露ase的上游进一步阻碍了在AS关系中需要更高隐私级别的ase的部署。

有研究[5,8,12]基于区块链来防止路由泄漏。在区块链中，ASes共享它们的关系并将它们存储在块中。然而，它也直接暴露了机密的AS业务关系，从而影响了部署的动机。Yue等[48]在使用区块链进行路由泄漏检测时考虑了AS策略的隐私性。他们使用可信执行环境(TEE)[36]来实现隐私保护。然而，它要求每个链节点维护一个全局机密和防篡改的路由策略存储库，如果存在恶意行为的链节点，这就增加了路由策略泄漏的风险。此外，由于TEE使用硬件和软件相结合的方式来保护数据隐私，因此受到硬件漏洞的影响，其更新需要硬件更新。

在本文中，我们提出了一种使用基于区块链的联邦学习进行路由泄漏检测的方法，该方法考虑了AS业务关系信息的隐私保护，并使用AS三元组代替AS业务关系来训练模型。该方法使数据保持在本地，只共享模型更新，降低了数据泄露的风险。在区块链技术的帮助下，该方法可以对数据进行审计和跟踪。即使一个AS恶意地泄露了更新，它也不会泄露直接的业务关系信息。
此外，由于该方法使用AS三元组，因此还可以处理相互传输等复杂关系。

## 3.方法
在本节中，我们首先描述域间网络中的路由泄漏问题(第3.1节)，并概述解决该问题的拟议框架(第3.2节)。接下来，我们描述了如何使用已知的本地路由策略生成本地训练数据的数据处理细节(第3.3节)。然后，我们介绍了区块链中的模型共享和存储(第3.4节)，并讨论了训练任务的总理论成本(第3.5节)。最后，分析了影响所提出的路由泄漏检测方法部署的因素(第3.6节)。

### 3.1 问题描述
正如2.1节所介绍的，我们可以得出结论，从一个提供商或对等体学到的路由不能导出到另一个提供商或对等体。例如，如图1所示，由于配置错误，AS4将从其提供者AS1学到的路由泄露给了另一个提供者AS2。然后AS2将路由转发给其他邻居。对于AS2和对等体AS5来说，它们只知道直接邻居和自己之间的业务关系，而不知道AS1和AS4之间准确的业务关系，这使得AS2和AS5都难以识别泄漏路由。如果AS4将与AS1的关系共享给AS2或AS5，则AS2或AS5中至少有一个可以检测到路由泄漏并停止恶意路由的传播。换句话说，路由泄漏检测的挑战在于尽可能准确地获得其他AS的AS业务关系。

![](images/Pasted%20image%2020230611105304.png)

域间网络是一个分布式但又相互协作的系统，各个自治系统之间交换路由，这意味着单个自治系统的业务关系不可能完全隐藏在真实网络中[47]。尽管由于公共BGP的更新已经暴露了一些业务关系，但是由于业务竞争的关系，ASes在主动公布业务关系信息时仍然犹豫不决。因此，为了便于检测系统的部署，我们考虑增加从外部获取关系信息的难度，以保护隐私。我们不要求ASes直接公开它们的业务关系。相反，我们使用带有恶意或常规标签的AS三元组[23] (vi−1,vi,vi+1)来隐藏AS业务关系。例如，vi−1和vi+1都是AS vi的直接邻居。如果三元组(vi−1,vi,vi+1)违反了路由策略，则将其标记为恶意。因此，将路由泄漏检测问题转化为尽可能多地共享带标签的AS三元组。

为了解决上面定义的问题，我们提出了一种称为FL-RLD的方法，使用基于区块链的联邦学习框架共享AS三元组，其中区块链用于为联邦学习提供安全系统[50]。与使用分布式存储库存储这些AS三元组相比，联邦学习提供了更低的隐私泄露风险，因为它允许将私有数据保存在本地，并上传经过训练的本地模型的更新，而不是AS三元组。因此，我们进一步将问题从共享As三元组转变为共享本地模型更新。

总之，我们首先使用本地AS连接生成AS三元组。然后，使用已知的AS业务关系来确定这些三元组是否是路由泄漏。决策被表示为AS三元组的标签。接下来，ASes使用它们的AS三元组和标签来训练本地模型并共享本地模型的更新。最后，将路由泄漏检测中AS业务关系的共享转化为本地模型更新的共享。

### 3.2 方案框架概述
解决方案框架如图2所示。在框架中，每个AS部署一个称为ASchain Manager的区块链节点。假设大多数ASes都是诚实但好奇的。ASchain Manager负责管理区块链网络和联邦学习任务。如图2所示，每个ASchain Manager在一个任务中至少有两个阶段。第一阶段是使用本地训练数据训练其本地模型，并将本地模型的更新上传到区块链网络。本地训练数据由本地路由策略生成，有关生成的详细信息将在3.3节中介绍。第二阶段是将接收到的更新聚合为全局模型更新，并广播聚合的全局更新以达成共识。在共识中，每个ASchain Manager将验证从其他人那里收到的全局更新。达成共识后，达成共识的赢家进入第三阶段，即将全局模型更新存储在区块链中。鉴于关于共识机制的成就和基于区块链的联邦框架的其他安全问题的大量研究[20,25,38]，我们将重点放在定制框架上，以学习域间路由策略。

![](images/Pasted%20image%2020230612203554.png)

具体的训练过程如图3所示。在初始状态下，假设一个授权组织在区块链网络中发布一个学习任务，网络中的每个ASchain Manager都可以获得学习任务的所有要求，如初始训练模型和训练纪元。(步骤①)当任务启动时，ASchain manager从区块链中检索任务信息。(步骤②)ASchain manager使用本地训练数据来训练他们的本地模型。本地训练数据由使用本地路由策略生成标签的AS三元组组成。(步骤③)在每个全局训练时期，ASchain Manager对本地模型的更新进行加密并传播到网络。其他ASchain管理器解密并验证接收到的本地更新。(步骤④)在所有本地更新都被验证后，ASchain Manager开始将这些本地更新聚合为全局模型更新，并(步骤⑤)将其传播到网络以与其他人达成共识。(步骤⑥)共识的赢家将生成一个新的区块，并将聚合的全局更新存储在区块链中。(步骤⑦)如果训练没有完成，ASchain Manager使用商定的全局模型更新更新本地模型，并重复步骤②到⑥。

![](images/Pasted%20image%2020230612203747.png)

### 3.3 数据处理
下一步，我们将ase的原始本地数据处理为训练数据。训练数据由AS三元组和指示它们是否恶意的标签组成。对于AS三元组(vi+1,vi,vi−1)，AS vi−1是vi的上一跳AS。AS vi+1是vi的下一跳AS。即，AS vi从AS vi−1接收BGP路由，并将该路由发送给AS vi+1。例如，AS m有两个邻居，AS ma和AS mb。那么，m的可能AS三元组是(ma,m,mb)， (mb,m,ma)， (m,ma,mb)， (m,ma,mb)。标签是根据本地路由策略生成的，这些策略包括自治系统的业务关系和自治系统稳定的路由信息库(routing Information Base, RIB)。RIB包含被选中的路由信息。AS三元组及其标签的组合被定义为样品。因此，对于每个AS，训练数据可以分为两个组成部分，基于关系信息的直接样本和基于稳定RIB的推断样本(例如，在RIB中出现超过一周的路线可以认为是稳定的)。

除了无谷规则之外，还可以使用其他路由策略来标记自治系统三元组。例如，对于AS三元组(a,b,c)，其中a是b的客户，b是c的客户，AS b可能不允许从a学到的路由输出到AS c，即使它没有打破无谷规则。在这种情况下，AS b只需要将(a,b,c)标记为恶意，而不需要导出特定的路由策略。因此，还可以处理具有复杂关系(如兄弟关系和部分传输关系)的ase。然而，由于其他个别路由策略的保密性和无谷规则的普遍使用，我们在实验中主要考虑基于无谷规则的简单业务关系和标记as三元组。

在AS vi的直接样本(vi−1,vi,vi+1，ω)中，可能的泄漏点是vi，并且vi−1,vi+1都是vi的直接邻居。ω是直接AS三元组(vi−1,vi,vi+1)的标签。在AS vi的推断样本(vi+1,vi−1,vi，ω)中，可能的泄漏点是vi−1，并且vi+1,vi−1都是vi的直接邻居。ω是推断出的AS三元组(vi+1,vi−1,vi)的标签。直接样本是基于与邻居的已知业务关系。推断的样本是基于已知邻居的排列。直接样本只能包含关于vi的单跳视觉的场景，而推断样本包含部分两跳视觉。因此，推断的样本被用来拓宽AS vi的视野。这两种三元组的主要区别在于，直接三元组中可能的泄密者是AS本身vi，而推理三元组中可能的泄密者是vi的邻居。标记AS三元组的详细过程如下所述。

```text
三元组标记
(1)对于vi的直接三元组DiT中的每个三元组(vi−1,vi,vi+1): 
	(a)如果vi是vi−1的客户或对等体，而vi+1是vi的提供者或对等体，则该三元组打破无谷规则，将(vi−1,vi,vi+1)的标签ω设为恶意。
	(b)否则，将(vi−1,vi,vi+1)的标号ω设为常规。
(2)对于vi的推理三元组InT中的每个三元组(vi+1,vi−1,vi): 
	(a)如果链接(vi+1,vi−1)从未出现在vi的本地稳定RIB中，则将(vi+1,vi−1,vi)的标签ω设为恶意。
	(b)否则，将(vi+1,vi−1,vi)的标号ω设为常规。
```

经过上述生成，每个自治系统可以获得各种三元组，包括恶意三元组和常规三元组。为了进一步丰富用于训练的三元组，我们总结出三元组的标签与其反向三元组的标签的关系模式，概括如下:

```text
反向三元组模式。对于vi的推理三元组InT中的每个三元组(vi+1,vi−1,vi):
(1)如果在稳定RIB中出现(vi+1,vi−1)链路:
	(a)如果三元组的标记是常规的，则(vi+1,vi−1,vi)的反向三元组(vi,vi−1,vi+1)被标记为常规的。
	(b)如果三元组的标签是恶意的，并且vi - 1是vi的对等体或客户，则(vi+1,vi - 1,vi)的反向三元组(vi,vi - 1,vi+1)被标记为恶意的。
(2)否则，中断。
```

使用反向三元组模式，我们从最初生成的三元组扩展了更多三元组。这些三元组和它们的标签被组合成用于联邦学习的本地训练数据。为了表达清楚，算法1展示了训练数据的生成过程，包括AS三元组的生成和标记。这样，即使知道AS三元组是恶意的，也不知道这三个AS之间确切的AS业务关系类型。

![](images/Pasted%20image%2020230612210129.png)

### 3.4 模型在区块链中的共享和存储
在解决方案框架中，除了避免传统联邦学习中的单点故障外，还使用区块链来共享和存储模型更新，例如保护数据不被篡改。如算法2所示，在每个全局epoch中，参与者将使用最新的全局模型更新来更新本地模型，以进行下一次全局训练。因此，如果篡改了最新的全局模型更新，参与者将获得错误的模型，从而破坏训练结果。区块链的使用可以为存储数据提供更多的安全性。

![](images/Pasted%20image%2020230612210620.png)

模型共享。例如，区块链中的自治系统参与者可以通过权威机构(例如RIPE NCC、APNIC或大型isp)授权一个公私钥对(或一组密钥对)，并使用该密钥对签名或验证本地模型更新。通过这种方式，框架可以验证生成本地模型更新的AS参与者的身份。为了保证传输更新的安全性，可以在两个参与者之间建立HTTPS连接，防止攻击者访问更新[49]。为了满足隐私要求，基于区块链的联邦学习框架提出了许多方法，如[46]使用阈值paillier算法，[38]使用ShamirâĂŹs秘密共享方案，[6]使用差分隐私。








# 参考资料
[什么是BGP - 华为 (huawei.com)](https://support.huawei.com/enterprise/zh/doc/EDOC1100280707)

[关于BGP安全那些事儿 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/434629393)

[BGP劫持原理及如何防御 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/568323332)

