# 翻译

## 摘要

在跨域网络中，路由泄漏会导致Internet流量中断，并造成大规模的网络中断。为了准确检测路由泄漏，需要共享AS业务关系信息。但是，ase之间的业务关系信息是保密的。ase通常不愿意将这些信息透露给其他ase，尤其是它们的竞争对手。在本文中，我们提出了一种名为FL-RLD的方法，通过使用基于区块链的联邦学习框架来检测路由泄漏，同时维护ase之间业务关系的隐私，其中ase可以协作训练全局检测模型，而无需直接披露其特定的业务关系。为了缓解路由泄漏中缺乏真实验证数据的问题，FL-RLD提供了一种通过标记本地路由策略的AS三元组来进行自我验证的方案。我们评估了多种数据集下的FL-RLD，包括不平衡数据集和平衡数据集，并研究了不同拓扑下FL-RLD的不同部署策略。结果表明，无论数据集是均衡的还是不均衡的，FL-RLD检测路由泄漏的性能都优于单个AS检测。此外，结果表明，选择具有最多对等体的as来首次部署FL-RLD，在检测路由泄漏方面比选择具有最多提供者和客户的as带来更大的好处。

关键字：BGP安全，路由泄漏检测，联邦学习

## 1.引言

BGP (Border Gateway Protocol)是域间网络中用于自治系统(ASes)之间交换路由信息的协议。在BGP中，每个自治系统根据自己的路由策略选择最佳路由，并将选择的路由发布给邻居。与域内网络中的最短路径路由策略不同，域间网络中的路由策略更为复杂，因为它考虑了AS之间的业务关系，其中业务关系根据AS的经济因素可以分为两种类型:c2p (customer-to-provider)和p2p (peer-to-peer)。

域间路由策略在许多研究中得到了广泛的研究，如[2,9,11]。他们的分析表明，最常采用的政策是无谷规则（valley-free rule）[23]。在无谷规则中，从提供商或对等体学到的路由不应该导出到其他提供商或对等体。然而，由于错误配置和恶意攻击，路由公告可能会在违反双方商定的路由策略的情况下传播，这种情况被定义为路由泄漏[8,44]。

路由泄漏可以通过重定向流量导致重大中断，并带来遇到中间人攻击的风险[13]。例如，2015年3月12日，印度一家宽带提供商(AS17488)错误地向其提供商AS9498公布了300多个谷歌前缀，导致其用户无法访问谷歌的许多服务[28]。另一起事件发生在2021年2月11日，墨西哥的AS28548向其邻国泄露了2000多个前缀，影响了全球约80个国家[39]。由于严重的路由泄漏报告越来越多，路由泄漏检测变得越来越重要。

由于AS业务关系的保密性，检测路由泄漏是相当具有挑战性的。每个自治系统只知道自己和邻居之间的关系，但由于隐私问题，它不知道其他自治系统的确切关系。为了检测路由泄漏，一些研究[16,17,27,37]侧重于推断AS业务关系。然而，他们的推理技术在部分关键环节上仍然存在错误[17]。根据[35]的结果，在推断对等关系时，推理的精度可能会下降1425%。[5,8,12]等研究没有很好地考虑AS关系的隐私性，要求部署者直接披露AS关系信息，使得部署难以进行。

路由泄漏检测的另一个挑战是缺乏地面真值验证数据。只有少数破坏性路由泄漏事件得到了验证和报告。与客户感知服务(如多媒体服务)无关或不会导致严重中断的路由泄漏很难被发现和验证。例如，S. Abd等人[1]表明，在2006年至2018年期间，只有13起路由泄漏事件得到了验证。地面真值验证数据的缺乏使得传统机器学习技术等流行技术难以用于路由泄漏检测，因为它们通常需要大量具有高精度标签的训练数据来学习路由泄漏的重要特征。

联邦学习是一种分布式机器学习方法，它允许参与者协作训练模型，而无需将本地训练数据传输到中央服务器。每个参与者都可以使用他们的本地数据来训练一个本地模型。联邦学习不是对参与者的局部训练数据进行聚合，而是对参与者的局部模型更新进行聚合，可以保护参与者的数据隐私。然而，传统的联邦学习方法需要第三方服务器来聚合模型更新，这很容易出现单点故障。为了避免这个问题，提出了基于区块链的联邦学习框架[14,26,29,38]，该框架是去中心化的，将区块链的优势(例如区块链上的数据是不可变和可追溯的)与联邦学习的隐私保护技术相结合。

在本文中，我们提出了一种使用基于区块链的联邦学习框架进行路由泄漏检测的方法，即FL-RLD(基于区块链的路由泄漏检测联邦学习)。由于有大量的研究集中在解决区块链技术的安全性和效率[24]，我们主要考虑框架中联邦路由泄漏检测部分的设计。如前所述，一个自治系统具有有限的As业务关系信息，而路由泄漏检测则需要尽可能多的关系信息。通过使用联邦学习，AS可以通过共享模型更新而不是直接与其他人共享业务关系来协作训练模型以识别路由泄漏。此外，为了加强关系信息的隐私保护，我们建议用AS三元组代替业务关系来训练模型。通过使用本地路由策略将AS三元组标记为恶意或常规，我们的方法为路由泄漏中缺乏真实验证数据提供了解决方案。

在该方法中，首先，AS参与者使用已知的路由策略生成本地训练数据。本地训练数据由AS三元组和表示它们是否恶意的标签组成。然后，每个AS参与者使用其本地训练数据来训练本地模型，并通过区块链网络与其他参与者交换本地模型更新。在参与者的每一轮全局通信中，每个参与者将收集其他参与者的所有本地模型更新并将这些更新进行汇总。聚合的全局更新在区块链共识期间由参与者验证。在全局训练完成后，最终的全局模型更新存储在区块链中。AS参与者可以从区块链中检索全局模型更新，并利用它进行进一步的路由泄漏检测。

本文的贡献总结如下:
- 我们考虑了路由泄漏检测问题，并提出了一种通过AS三元组共享路由策略信息的隐私保护方法，而不是直接共享AS之间的业务关系。
- 我们定制了一个基于区块链的联邦学习框架，以学习域间网络中的路由策略，并协同训练一个模型来准确检测路由泄漏。
- 我们在不同的数据集上评估了所提出的方法，并分析了该方法在不同拓扑下的不同部署策略。结果表明，该方法可以提高单个自治系统检测路由泄漏的性能。结果还表明，部署具有最多对等体的as比部署具有最多提供者或客户的as更有助于检测路由泄漏。

本文的其余部分组织如下。第2节概述了路由泄漏的定义和检测路由泄漏的相关工作。在第3节中，我们介绍了路由泄漏检测问题和提出的解决方案。第4节介绍了所进行的实验和结果分析。第五部分是本文的结论。

## 2.背景及相关工作
在本节中，我们将概述路由泄漏的定义和检测路由泄漏的相关工作。

### 2.1 路由泄露
RFC 7908[44]中定义的路由泄漏分为六种类型。类型1:多宿主AS(有多个提供者)将从一个提供者学到的路由泄露给另一个上游提供者。类型2:AS将从一个对等体学到的路由泄露给另一个对等体。类型3:一个自治系统将从它的提供者学到的路由泄露给它的对等体。类型4:自治系统将从对等体学到的路由泄露给它的提供者。类型5:多归属自治系统将从一个上游ISP学到的路由作为源路由发布到另一个上游ISP。类型6:自治系统将其内部路由泄露给它的提供者或对等体。

Type 5和Type 6泄漏与起源前缀劫持更相关，可以通过路由起源验证(ROV)技术检测，如资源公钥基础设施(RPKI)[22]。RPKI可以构建一个可信任的存储库，用于验证前缀和原始ASN的所有权证书。类型1、类型2、类型3和类型4泄漏主要按ASes业务关系分组。图1展示了这四种类型的路由泄漏的简单示例，其中P是宣布路由。在本文中，我们主要关注类型1到类型4泄漏的检测。

![](images/Pasted%20image%2020230611105304.png)

### 2.2 路由泄露检测
Internet路由注册中心(IRRs)是公共分布式数据库，允许应用服务器注册和共享它们的路由策略。使用IRR中的信息，应用服务器可以检测违反路由策略的路由泄漏。然而，IRR数据库由不同的区域互联网注册管理机构(RIRs)或私人组织管理[30]，这对信息的同步和一致性提出了挑战。

RLP (route -leak Protection)[43]在BGP update消息中增加了一个新的BGP团体属性Down-only，用于检测和缓解路由泄漏。当接收到一条新路由时，会检查该路由的Down-only团体的值，以决定是否将该路由转发给上游提供商/对等体。如果该路由来自客户或对等as，而团体没有向上游as转发，则将该路由标记为路由泄漏。然而，在路由传播过程中，BGP团体的错误配置和Down-only团体的恶意修改或丢弃很容易影响RLP的性能[15]。

Li等[23]通过分析本地路由信息，得出了路由环路与路由泄漏之间的关系，并提出了一种检测路由泄漏的算法。但是，只有部分路由泄漏会导致路由环路。因此，它只能检测到部分路由泄漏。与[23]类似，Siddiqui等人[40]也开发了检测路由泄漏的理论框架。然而，该检测方法在路由泄漏初始化时有效，并不适合检测路由泄漏传播[40]。

对等锁定[41,42]是一种可部署的路由泄漏防御解决方案。它有两种ASes:保护者AS和受保护AS。如果路由经过受保护AS，但不是直接从受保护AS或其授权的上游AS到达，则保护AS将丢弃这些路由。然而，每个保护器和被保护对必须手动配置，缺乏有效的自动化方法[30]。

自治系统提供者授权(Autonomous System Provider Authorization, ASPA)[3]的核心思想类似于对等锁定。不同之处在于，ASPA基于RPKI，并向RPKI存储库添加了一种新类型的对象。新增对象包括下游自治系统和授权的上游自治系统。授权的上游自治系统可以传播下游自治系统的公告。通过验证对的证书，可以检测路由泄漏。然而，ASPA依赖于RPKI，而RPKI存在部署缓慢和由于发布roa不佳而导致的断开等问题[10]，这可能会影响ASPA的检测有效性。此外，在RPKI存储库中公开披露ase的上游进一步阻碍了在AS关系中需要更高隐私级别的ase的部署。

有研究[5,8,12]基于区块链来防止路由泄漏。在区块链中，ASes共享它们的关系并将它们存储在块中。然而，它也直接暴露了机密的AS业务关系，从而影响了部署的动机。Yue等[48]在使用区块链进行路由泄漏检测时考虑了AS策略的隐私性。他们使用可信执行环境(TEE)[36]来实现隐私保护。然而，它要求每个链节点维护一个全局机密和防篡改的路由策略存储库，如果存在恶意行为的链节点，这就增加了路由策略泄漏的风险。此外，由于TEE使用硬件和软件相结合的方式来保护数据隐私，因此受到硬件漏洞的影响，其更新需要硬件更新。

在本文中，我们提出了一种使用基于区块链的联邦学习进行路由泄漏检测的方法，该方法考虑了AS业务关系信息的隐私保护，并使用AS三元组代替AS业务关系来训练模型。该方法使数据保持在本地，只共享模型更新，降低了数据泄露的风险。在区块链技术的帮助下，该方法可以对数据进行审计和跟踪。即使一个AS恶意地泄露了更新，它也不会泄露直接的业务关系信息。
此外，由于该方法使用AS三元组，因此还可以处理相互传输等复杂关系。

## 3.方法
在本节中，我们首先描述域间网络中的路由泄漏问题(第3.1节)，并概述解决该问题的拟议框架(第3.2节)。接下来，我们描述了如何使用已知的本地路由策略生成本地训练数据的数据处理细节(第3.3节)。然后，我们介绍了区块链中的模型共享和存储(第3.4节)，并讨论了训练任务的总理论成本(第3.5节)。最后，分析了影响所提出的路由泄漏检测方法部署的因素(第3.6节)。

### 3.1 问题描述
正如2.1节所介绍的，我们可以得出结论，从一个提供商或对等体学到的路由不能导出到另一个提供商或对等体。例如，如图1所示，由于配置错误，AS4将从其提供者AS1学到的路由泄露给了另一个提供者AS2。然后AS2将路由转发给其他邻居。对于AS2和对等体AS5来说，它们只知道直接邻居和自己之间的业务关系，而不知道AS1和AS4之间准确的业务关系，这使得AS2和AS5都难以识别泄漏路由。如果AS4将与AS1的关系共享给AS2或AS5，则AS2或AS5中至少有一个可以检测到路由泄漏并停止恶意路由的传播。换句话说，路由泄漏检测的挑战在于尽可能准确地获得其他AS的AS业务关系。

![](images/Pasted%20image%2020230611105304.png)

域间网络是一个分布式但又相互协作的系统，各个自治系统之间交换路由，这意味着单个自治系统的业务关系不可能完全隐藏在真实网络中[47]。尽管由于公共BGP的更新已经暴露了一些业务关系，但是由于业务竞争的关系，ASes在主动公布业务关系信息时仍然犹豫不决。因此，为了便于检测系统的部署，我们考虑增加从外部获取关系信息的难度，以保护隐私。我们不要求ASes直接公开它们的业务关系。相反，我们使用带有恶意或常规标签的AS三元组[23] (vi−1,vi,vi+1)来隐藏AS业务关系。例如，vi−1和vi+1都是AS vi的直接邻居。如果三元组(vi−1,vi,vi+1)违反了路由策略，则将其标记为恶意。因此，将路由泄漏检测问题转化为尽可能多地共享带标签的AS三元组。

为了解决上面定义的问题，我们提出了一种称为FL-RLD的方法，使用基于区块链的联邦学习框架共享AS三元组，其中区块链用于为联邦学习提供安全系统[50]。与使用分布式存储库存储这些AS三元组相比，联邦学习提供了更低的隐私泄露风险，因为它允许将私有数据保存在本地，并上传经过训练的本地模型的更新，而不是AS三元组。因此，我们进一步将问题从共享As三元组转变为共享本地模型更新。

总之，我们首先使用本地AS连接生成AS三元组。然后，使用已知的AS业务关系来确定这些三元组是否是路由泄漏。决策被表示为AS三元组的标签。接下来，ASes使用它们的AS三元组和标签来训练本地模型并共享本地模型的更新。最后，将路由泄漏检测中AS业务关系的共享转化为本地模型更新的共享。

### 3.2 方案框架概述
解决方案框架如图2所示。在框架中，每个AS部署一个称为ASchain Manager的区块链节点。假设大多数ASes都是诚实但好奇的。ASchain Manager负责管理区块链网络和联邦学习任务。如图2所示，每个ASchain Manager在一个任务中至少有两个阶段。第一阶段是使用本地训练数据训练其本地模型，并将本地模型的更新上传到区块链网络。本地训练数据由本地路由策略生成，有关生成的详细信息将在3.3节中介绍。第二阶段是将接收到的更新聚合为全局模型更新，并广播聚合的全局更新以达成共识。在共识中，每个ASchain Manager将验证从其他人那里收到的全局更新。达成共识后，达成共识的赢家进入第三阶段，即将全局模型更新存储在区块链中。鉴于关于共识机制的成就和基于区块链的联邦框架的其他安全问题的大量研究[20,25,38]，我们将重点放在定制框架上，以学习域间路由策略。

![](images/Pasted%20image%2020230612203554.png)

具体的训练过程如图3所示。在初始状态下，假设一个授权组织在区块链网络中发布一个学习任务，网络中的每个ASchain Manager都可以获得学习任务的所有要求，如初始训练模型和训练纪元。(步骤①)当任务启动时，ASchain manager从区块链中检索任务信息。(步骤②)ASchain manager使用本地训练数据来训练他们的本地模型。本地训练数据由使用本地路由策略生成标签的AS三元组组成。(步骤③)在每个全局训练时期，ASchain Manager对本地模型的更新进行加密并传播到网络。其他ASchain管理器解密并验证接收到的本地更新。(步骤④)在所有本地更新都被验证后，ASchain Manager开始将这些本地更新聚合为全局模型更新，并(步骤⑤)将其传播到网络以与其他人达成共识。(步骤⑥)共识的赢家将生成一个新的区块，并将聚合的全局更新存储在区块链中。(步骤⑦)如果训练没有完成，ASchain Manager使用商定的全局模型更新更新本地模型，并重复步骤②到⑥。

![](images/Pasted%20image%2020230612203747.png)

### 3.3 数据处理
下一步，我们将ase的原始本地数据处理为训练数据。训练数据由AS三元组和指示它们是否恶意的标签组成。对于AS三元组(vi+1,vi,vi−1)，AS vi−1是vi的上一跳AS。AS vi+1是vi的下一跳AS。即，AS vi从AS vi−1接收BGP路由，并将该路由发送给AS vi+1。例如，AS m有两个邻居，AS ma和AS mb。那么，m的可能AS三元组是(ma,m,mb)， (mb,m,ma)， (m,ma,mb)， (m,mb,ma)。标签是根据本地路由策略生成的，这些策略包括自治系统的业务关系和自治系统稳定的路由信息库(routing Information Base, RIB)。RIB包含被选中的路由信息。AS三元组及其标签的组合被定义为样本。因此，对于每个AS，训练数据可以分为两个组成部分，基于关系信息的直接样本和基于稳定RIB的推断样本(例如，在RIB中出现超过一周的路线可以认为是稳定的)。

除了无谷规则之外，还可以使用其他路由策略来标记自治系统三元组。例如，对于AS三元组(a,b,c)，其中a是b的客户，b是c的客户，AS b可能不允许从a学到的路由输出到AS c，即使它没有打破无谷规则。在这种情况下，AS b只需要将(a,b,c)标记为恶意，而不需要导出特定的路由策略。因此，还可以处理具有复杂关系(如兄弟关系和部分传输关系)的ase。然而，由于其他个别路由策略的保密性和无谷规则的普遍使用，我们在实验中主要考虑基于无谷规则的简单业务关系和标记as三元组。

在AS vi的直接样本(vi−1,vi,vi+1，ω)中，可能的泄漏点是vi，并且vi−1,vi+1都是vi的直接邻居。ω是直接AS三元组(vi−1,vi,vi+1)的标签。在AS vi的推断样本(vi+1,vi−1,vi，ω)中，可能的泄漏点是vi−1，并且vi+1,vi−1都是vi的直接邻居。ω是推断出的AS三元组(vi+1,vi−1,vi)的标签。直接样本是基于与邻居的已知业务关系。推断的样本是基于已知邻居的排列。直接样本只能包含关于vi的单跳视觉的场景，而推断样本包含部分两跳视觉。因此，推断的样本被用来拓宽AS vi的视野。这两种三元组的主要区别在于，直接三元组中可能的泄密者是AS本身vi，而推理三元组中可能的泄密者是vi的邻居。标记AS三元组的详细过程如下所述。

```text
三元组标记
(1)对于vi的直接三元组DiT中的每个三元组(vi−1,vi,vi+1): 
	(a)如果vi是vi−1的客户或对等体，而vi+1是vi的提供者或对等体，则该三元组打破无谷规则，将(vi−1,vi,vi+1)的标签ω设为恶意。
	(b)否则，将(vi−1,vi,vi+1)的标号ω设为常规。
(2)对于vi的推理三元组InT中的每个三元组(vi+1,vi−1,vi): 
	(a)如果链接(vi+1,vi−1)从未出现在vi的本地稳定RIB中，则将(vi+1,vi−1,vi)的标签ω设为恶意。
	(b)否则，将(vi+1,vi−1,vi)的标号ω设为常规。
```

经过上述生成，每个自治系统可以获得各种三元组，包括恶意三元组和常规三元组。为了进一步丰富用于训练的三元组，我们总结出三元组的标签与其反向三元组的标签的关系模式，概括如下:

```text
反向三元组模式。对于vi的推理三元组InT中的每个三元组(vi+1,vi−1,vi):
(1)如果在稳定RIB中出现(vi+1,vi−1)链路:
	(a)如果三元组的标记是常规的，则(vi+1,vi−1,vi)的反向三元组(vi,vi−1,vi+1)被标记为常规的。
	(b)如果三元组的标签是恶意的，并且vi - 1是vi的对等体或客户，则(vi+1,vi - 1,vi)的反向三元组(vi,vi - 1,vi+1)被标记为恶意的。
(2)否则，中断。
```

使用反向三元组模式，我们从最初生成的三元组扩展了更多三元组。这些三元组和它们的标签被组合成用于联邦学习的本地训练数据。为了表达清楚，算法1展示了训练数据的生成过程，包括AS三元组的生成和标记。这样，即使知道AS三元组是恶意的，也不知道这三个AS之间确切的AS业务关系类型。

![](images/Pasted%20image%2020230612210129.png)

### 3.4 模型在区块链中的共享和存储
在解决方案框架中，除了避免传统联邦学习中的单点故障外，区块链还被用来共享和存储模型更新，例如保护数据不被篡改。如算法2所示，在每个全局epoch中，参与者将使用最新的全局模型更新来更新本地模型，以进行下一次全局训练。因此，如果篡改了最新的全局模型更新，参与者将获得错误的模型，从而破坏训练结果。区块链的使用可以为存储数据提供更多的安全性。

![](images/Pasted%20image%2020230612210620.png)

模型共享。例如，区块链中的AS参与者可以通过权威机构(例如RIPE NCC, APNIC或大型isp)授权其自治系统号(ASN)的公私密钥对(或一组密钥对)，并使用该密钥对签名或验证本地模型更新。通过这种方式，框架可以验证生成本地模型更新的AS参与者的身份。为了保证传输更新的安全性，可以在两个参与者之间建立HTTPS连接，防止攻击者访问更新[49]。为了满足隐私要求，基于区块链的联邦学习框架提出了许多方法，如[46]使用阈值paillier算法，[38]使用ShamirâĂŹs秘密共享方案，[6]使用差分隐私。

模型存储。区块链的无篡改特性使我们能够跟踪和验证上传的记录，从而确保记录的完整性。初始块记录初始训练模型和任务信息。共识过程用于确保聚合获得的全局模型更新是唯一的，这可以通过权益证明(PoS)或Raft consensus来实现[5,34]。在共识过程之后，每个全局训练epoch的结果作为区块的事务存储在区块链中。例如，第k个全局训练结果可以定义为$Yk = [Hash(Y_{k−1})，T_s, T_{exp}， Γ， M_k, SIG_x(Y_k)， x]$ ，其中Hash(Yk−1)是前一个块的哈希值。区块链中的块存储在链结构中。$T_s$和$T_{exp}$分别是块的生成时间和过期时间。Γ是全局模型更新。SIGx(Yk)是获胜参与者x的区块签名，Mk记录了参与者的ASN。因此，一旦一个全局epoch完成，参与者可以从区块链下载全局模型更新来更新他们的本地模型。

### 3.5 理论成本分析
结合图3中的训练过程和算法2中的训练算法，一个训练任务的总开销可以分为三个部分:本地计算开销(步骤①、②、④)，全局通信开销(步骤③、⑤)，存储开销(步骤⑦)。通过分析训练任务的成本，我们可以更清楚地了解所提出的方法FL-RLD。

本地计算开销。设$L^i(D_m)$为参与者m∈m在第i个本地训练epoch的本地训练成本，其中Dm为m的局部训练数据，ak为第k个全局训练的模型聚合开销。因此，局部计算代价为$\sum^{ce}_i L^i(D_m) + a_k$，其中ce为本地训练epoch, Dm为m的本地数据集。

全局通信开销。全局通信开销包括交换本地更新和对聚合全局更新达成共识两部分。首先，设$\delta^k_m$为m在第k个全局训练epoch中的本地更新。假设任意两个参与者之间的通信成本为$\Delta(\delta^k_m)$。因此，广播m的本地模型更新的成本定义为$(|M|-1)\Delta(\delta^k_m)$，其中|M|是参与者的数量。然后设$\zeta^k(|M|)$为第k个全局epoch的共识代价。最后，全局总通信成本为$\sum^{ge}_k \sum_{m \in M}((|M|-1)\Delta(\delta^k_m)+\zeta^k(|M|))$，其中ge为全局训练epoch。

存储开销。每个全局训练epoch的全局更新以块的形式存储。存储成本与模型更新的大小有关，因此存储成本为$\sum^{ge}_k f(\Gamma^k)$，其中$\Gamma^k$为第k个全局训练epoch的全局模型更新。

因此，一个训练任务的总成本可以表示为:

![](images/Pasted%20image%2020230612213243.png)

公式(1)中使用的参数汇总如表1所示。

![](images/Pasted%20image%2020230612213658.png)

### 3.6 影响部署的因素
在这里，为了促进部署，我们讨论了哪些因素会影响所提出方法的检测有效性。

将网络建模为图G(V, E)，其中V是网络中所有ASes的集合，E表示ase之间的直接链接。在图中，M是部署了所提出的检测系统的一组ase，其中$M \subset V$。对于每个AS v∈M, m的本地训练数据表示为Dv，其中|Dv|≥0。因此，M的共享本地训练数据可以定义为D={Dv|∀v∈M}，并用于协同训练一个全局模型，以识别输入as三元组是恶意的还是正常的。因此，全局模型的目标是尽可能多地记住AS三元组的映射及其局部训练数据的标签。将全局模型正确识别D中恶意AS三元组的精度设为θ，其中0≤θ≤1。

假设θ = 1，考虑AS vk+1∈M收到泄漏通知R={v1，…, vh,…，vk}，泄漏AS为vh。那么，vk+1检测到恶意路由有两种情况，如式(2)所示。

![](images/Pasted%20image%2020230612213814.png)

如果vh∈M，则AS三元组(vh−1,vh,vh+1)及其标签在D中，因此，AS vk+1可以识别R为恶意公告。对于vh M，如果vh+1∈M，且AS三元组(vh−1,vh,vh+1)在D中，则AS vk+1可以识别出R是恶意的。

当θ = 1时，全局模型可以识别出D中的每个AS三元组是否为恶意。因此，一旦AS v∈M接收到D中包含恶意AS三元组的公告，它就会正确检测到该恶意公告。如果θ < 1，则全局模型可以识别的恶意AS三元组的个数为θ·|D|。

因此，可以得出路由泄漏检测的性能取决于两个部分，即全局模型的准确性和恶意AS三元组的数量。在相同精度的全局模型下，随着D中恶意as三元组数量的增加，检测到的路由泄漏数量也会增加。

## 4. FL-RLD的实验与分析
在本节中，我们给出了实验设置的描述和实验结果。首先，对所提出的检测方法进行了性能评价。然后，为了更多地了解可能的路由泄漏，我们探索了有关生成三元组的特征，例如恶意三元组和常规三元组的比例，以及这两种类型的三元组在过去四年中的变化情况。此外，我们还研究了不同部署策略对检测到的泄漏数量的影响。

### 4.1 实验设置
拓扑。评估中使用的BGP拓扑数据来自IPv6的CAIDA January 2021 AS关系数据集[4]，该数据集包含12,721个AS和173,462条AS链路。我们使用3.3节中介绍的方法为网络中的ase生成三元组及其标签。

训练数据细节。在实际网络中，由于不同的ase的提供者、客户和对等体的数量不同，因此不同的ase的三元组数量和标签类分布也不同。因此，参与者训练数据的大小和标签分布可能存在平衡或不平衡。为了接近真实网络，我们在平衡和不平衡数据集上评估了所提出方法的性能。为此，我们选择了四组联邦学习参与者进行测试。每组有五名参与者。组的参与者表示为Client1、Client2、Client3、Client4和Client5。关于这些组的详细信息见表2。例如，在组1中，参与者的本地训练数据大小不同，恶意三元组和常规三元组的数量不相等。在第三组中，参与者的恶意三元组和正常三元组数量相同，但他们的三元组总数不同。第3组和第4组的参与者相同，但训练样本不同。第3组和第4组的抽样由imbalance -learn的RandomUnderSampler实现[21]。我们对以上四组进行了测试。

![](images/Pasted%20image%2020230612214326.png)

训练和实现细节。我们给训练模型输入AS三元组。该模型预测AS三元组的标签。通过比较真实标签和预测标签，模型不断调整其参数以提高预测的准确性。训练模型使用LSTM网络。长短期记忆(LSTM)是一种特殊的神经网络，具有记忆长短期信息的能力，是一种简单的解决方案，满足了我们的训练需求。

训练网络的细节和参数设置如下。FL-RLD的实现使用Python和Keras[18]。初始训练模型是一个简单的LSTM网络，如表3所示。它包括一个LSTM层(输入层)、一个隐藏层和一个输出层。LSTM层的输入大小为(1,96)，输出大小为(1,128)。隐藏层的输出大小为(1,64)，其激活函数为ReLU[33]。输出层的输出大小为(1,2)，其激活函数为Softmax。对于输出层的每个2位向量，如果第一个比特大于第二个比特，则将其预测为常规三元组。否则，它将被预测为恶意三元组。该模型采用Adam优化器[19]作为优化过程，批大小为32。将模型的学习率设置为0.001，使用FedAvg算法[31]对局部更新进行聚合。局部训练epoch设置为2，全局训练epoch设置在70到100之间。为了更好地将AS三元组放入训练网络中，通过将十进制转换为二进制，将每个ASN嵌入为32位向量。局部训练epoch设置为2，全局训练epoch设置在70到100之间。在每个实验中，使用来自一组的所有局部训练数据来测试训练好的模型。

评价指标。与许多检测方法类似，如[7,32]，使用了四个评估指标，即Accuracy, Precision, Recall和F1分数。它们的定义如下，其中准确性和F1分数是我们的主要评估指标。

![](images/Pasted%20image%2020230612214603.png)

真阳性(TP)和假阴性(FN)是模型分别预测为恶意和常规的真实恶意三元组的数量。真阴性(TN)和假阳性(FP)是模型分别预测为正常和异常的真正则三元组的数量。
- 准确性可以显示正确预测的三元组与总三元组的比率，并给出该方法的整体预测精度。
- 精度侧重于评估预测为恶意的三元组中有多少是真正的恶意三元组。
- 召回的重点是评估有多少恶意三元组被成功预测为恶意。
- F1分数是Precision和Recall的调和平均值[45]。

如果模型具有较高的召回率但较低的精度，则会将许多常规三元组判定为恶意，从而带来大量的误报。反之，如果模型精度高，召回率低，则会将许多恶意三元组判定为规则组，无法有效识别路由泄漏。我们希望不要错过恶意三重(增加召回)，也不要误判常规三重(增加精度)。因此，Precision和Recall同样重要，我们使用F1分数来评估Precision和Recall的性能。

比较的方法。我们用FL-RLD表示所提出的方法，用CL表示中心学习方法。CL与FL-RLD的不同之处在于，CL将一组参与者的所有本地训练数据传输到单个服务器上进行模型训练，而FL-RLD将数据训练保持在本地。C1、C2、C3、C4和C5分别代表参与者Client1、Client2、Client3、Client4和Client5的单一AS学习方法。因此，单一学习方法只能利用单个自治系统的局部训练数据来训练模型。例如，第1组中C1的训练数据使用Client1的本地训练数据，而CL的训练数据进行比较的是第1组的总As三元组。FL-RLD、CL、C1/C2/C3/C4的训练模型都是一样的。

传统的检测方法是通过以各种方式存储AS业务关系并过滤掉不匹配的路由(例如，建立一个类似RPKI的存储库来存储路由客户-提供者权限对象[3]，标记“Down-only”路由[43]以防止将路由转发给上游提供商或对等体)。因此，在上述分析的基础上，我们建模了三种不同的方法DSrandom、DS-0、DS-1，并与FL-RLD进行比较，其中DS表示在全局存储库中直接共享AS关系。这三种方法都构建了一个全局存储库，其中组的所有参与者直接共享其AS关系。理想情况下，如果测试数据中AS三元组的所有关系信息都在全局存储库中，则输出正确的结果。否则，它们会做出不同的反应:1)DS-random将随机输出一个结果。2) DS-0会将此AS 三元组标记为恶意。DS-1会将此AS三元组标记为正常。

### 4.2 性能
单AS vs. FL-RLD。首先，对多个AS训练的全局模型和单个AS训练的模型进行了比较。结果如图4所示。其中，图4(a)和图4(b)为类别分布不平衡数据集下的结果，图4(c)和图4(d)为类别分布平衡数据集下的结果。在图4中，FL-RLD在不同数据集组下的所有评估指标中表现优于C1、C2、C3、C4和C5，这为ase加入联邦学习提供了激励。例如，在图4(b)中，C1到C5的准确率都低于0.8，但当它们加入联邦学习时，准确率都大于0.95。结果还表明，FL-RLD与CL(理想方法)在性能上的差异很小(例如，在第1组中精度小于0.06)，这表明FL-RLD无需将所有本地数据传输到中央服务器进行模型训练即可达到相似的性能。

![](images/Pasted%20image%2020230614155947.png)

全局存储库与FL-RLD。在图5中，我们将FL-RLD与DS-random、DS-0和DS-1进行比较，其中这三种比较方法都基于共享一个全局业务关系存储库。如前所述，这三种方法之间的主要区别在于，当As关系信息不在训练数据中时，它们的响应不同。从图5的结果可以看出，FL-RLD和DS-0的性能优于其他的，FLRLD的性能平均优于DS-0。DS-1的表现最差，因为标记为恶意的三元组的数量比普通三元组多，而DS-1将所有未知三元组分类为普通三元组，因此召回率很低。DS-0将所有未知三元组都归类为恶意，因此性能优于DS-1。但是DS-1的精度低，虚警高。与DS-1和DS-0相比，FL-RLD在查准率和查全率方面都表现良好。

![](images/Pasted%20image%2020230614160141.png)

多个AS vs.单个AS。图6显示了不同参与者人数下FL-RLD的性能，其中参与者是从图中随机选择的(即P0, P1, P2, P3, P4)，测试数据集是所有被选中的参与者的本地训练数据集的组合。正如我们所看到的，随着参与者数量的增加，可以检测到更多的恶意三元组。图7显示了不同参与者组合下FL-RLD的性能，其中P0+P1表示P0和P1使用FL-RLD协同训练全局模型。对于参与者P0，与不同的参与者合作，可以检测到不同数量的恶意三元组。实验还表明，采用合作训练的模型比不采用合作训练的模型能检测出更多的恶意三元组。在图7(a)和图7(a)中，结果显示，经过100个全局训练epoch后，这些模型可以达到0.99以上的准确率，这意味着它们可以记住99%以上的训练数据集。

![](images/Pasted%20image%2020230614160159.png)

![](images/Pasted%20image%2020230614160315.png)

有区块链vs.没有区块链。FL-RLD中的区块链用于保护模型更新不被篡改。为了更好地展示使用区块链的好处，我们设计了两种数据篡改攻击，旨在通过修改全局模型更新来破坏训练。攻击者将分别在第3个全局训练epoch和第10个全局训练epoch攻击全局模型。图8显示了三个训练过程在遇到这些攻击时的训练精度，其中训练过程1使用区块链，训练过程2和3不使用区块链。通过使用区块链，可以保护训练过程1的全局模型不被攻击者篡改，因为模型更新被安全地存储在块中，不容易被篡改。因此，训练过程1不受攻击的影响。然而，由于缺乏区块链保护，训练过程2和3的全局模型更新更容易被攻击者修改，导致训练精度急剧下降。

![](images/Pasted%20image%2020230614160337.png)

### 4.3 数据集分析与部署分析
如3.6节所分析，训练数据中包含的恶意As三元组越多，FL-RLD能够准确检测到的路由泄漏就越多。因此，我们看一下整个图的AS三元组，并分析AS三元组随时间的分布。为此，我们收集了2021年、2020年、2019年和2018年不同年份的四种拓扑。它们都是由IPv6的CAIDA AS关系数据集构建的。之后，为了便于部署，我们进一步研究了在全局模型精度θ为1的情况下，不同部署策略下可检测到的恶意AS三元组数量与部署速率的关系。

数据集分析:恶意AS三元组vs.常规AS三元组。图9显示了在FL-RLD中按年分组的不同拓扑数据下，本地训练数据的恶意三元组和规则三元组的比例。我们可以看到，结果表明，在局部训练数据中，恶意三元组的数量(约60%-70%)多于常规三元组(约30%-40%)。这是因为点对点关系的数量比提供者对客户关系的数量要多，这可能导致大量的路由泄漏。请注意，对于特定的AS, AS三重分布可能会因整个图而不同。此外，在整个图中，恶意AS三元组的总数高于常规AS三元组，但实际网络中的大多数AS都是正常的，只有少数AS是恶意的。因此，实际的路由公告中并没有那么多恶意AS三元组。对于FL-RLD中的训练，为了包含尽可能多的恶意案例，建议将恶意as三元组的总数添加到数据集中。

![](images/Pasted%20image%2020230614160509.png)

部署分析。图10为FL-RLD不同部署策略下，训练数据中恶意三元组占恶意三元组总数的分布图:
- 同行的策略。根据对等体的数量来部署应用服务器。对等体最多的自治系统首先部署。
- 客户策略。根据客户的数量来部署ase。客户最多的应用服务器首先部署。
- 提供商策略。根据提供程序的数量来部署应用程序。提供程序最多的AS首先部署。

结果表明，在相同的部署速率下，对等体部署策略比其他两种策略覆盖更多的恶意三元组。例如，在2021年的数据中，如果使用Peer部署策略，则只需部署875个as(部署率为0.06878)即可覆盖99%的恶意三元组，而在相同的部署率下，客户部署策略只能达到72%的覆盖率。它还表明具有大量对等体的as具有大量可能的恶意三元组。

## 5.结论
研究了域间网络中的路由泄漏检测问题，提出了一种基于区块链的联邦学习的隐私保护方法，利用精确的路由策略信息协同训练模型进行路由泄漏检测。与传统的路由泄漏检测方法相比，本文提出的FL-RLD方法考虑了AS业务关系的私密性，并代替直接的AS业务关系共享模型更新。为了解决路由泄漏中缺乏真实验证数据的问题，它提供了一种通过使用本地路由策略将AS三元组标记为恶意或常规的自验证方案。评估结果表明，FL-RLD可以提高单个自治系统检测路由泄漏的性能。当比较联邦学习方法和中央学习方法时，结果只有轻微的差异(例如，准确度在0.06左右)。在部署的分析结果中发现，选择具有最多对等体的AS进行部署比选择具有最多提供者和客户的AS可以为路由泄漏检测提供更显着的好处。

# 参考资料
[什么是BGP - 华为 (huawei.com)](https://support.huawei.com/enterprise/zh/doc/EDOC1100280707)

[关于BGP安全那些事儿 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/434629393)

[BGP劫持原理及如何防御 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/568323332)

[BGP的那些安全痛点（转） - 渗透测试中心 - 博客园 (cnblogs.com)](https://www.cnblogs.com/backlion/p/9546259.html)

