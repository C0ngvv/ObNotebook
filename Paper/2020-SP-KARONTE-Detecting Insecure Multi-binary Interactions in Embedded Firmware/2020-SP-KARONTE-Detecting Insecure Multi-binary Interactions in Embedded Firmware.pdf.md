---
title: 2020-SP-KARONTE-Detecting Insecure Multi-binary Interactions in Embedded Firmware.pdf
date: 2023/12/11
categories:
  - 论文
tags:
  - 论文翻译
---
# 2020-SP-KARONTE-Detecting Insecure Multi-binary Interactions in Embedded Firmware

## 摘要
低功耗、单一用途的嵌入式设备(如路由器和物联网设备)已经无处不在。虽然它们自动化并简化了用户生活的许多方面，但最近的大规模攻击表明，它们的数量之多对互联网基础设施构成了严重威胁。不幸的是，这些系统上的软件依赖于硬件，并且通常在具有非标准配置的独特最小环境中执行，这使得安全性分析特别具有挑战性。许多现有设备通过使用多个二进制文件来实现其功能。这种多二进制服务实现使得当前的静态和动态分析技术要么无效，要么效率低下，因为它们无法识别和充分建模各种可执行文件之间的通信。在本文中，我们提出KARONTE，一种静态分析方法，能够通过建模和跟踪多二进制交互来分析嵌入式设备固件。我们的方法在二进制文件之间传播污染信息，以检测不安全的交互并识别漏洞。我们首先在来自不同供应商的53个固件样本上对KARONTE进行了评估，结果表明我们的原型工具可以成功地跟踪和约束多二进制交互。这导致发现了46个零日漏洞。然后，我们在899个不同的样本上进行了大规模实验，结果表明KARONTE可以很好地适应不同大小和复杂程度的固件样本。

## 1.引言
由于小型互联嵌入式设备的激增，我们的世界的连通性正在急剧增加，这些设备正在取代传统的门锁、灯泡和许多其他以前不显眼的物体。不幸的是，在这些物联网(IoT)设备上运行的软件(或固件)很容易受到攻击[3]，[9]，[32]，这导致了地下物联网网络犯罪的发展[21]。例如，2016年，Mirai僵尸网络入侵了数百万台设备(如路由器和摄像头)，并利用它们进行拒绝服务攻击，破坏核心互联网服务并关闭网站[27]，[30]，[50]。

作为回应，研究人员提出了自动识别固件发行版中的漏洞的技术，通常是将它们解包为可分析的组件[11]，然后对其进行隔离分析[5]，[42]，[40]。然而，尽管漏洞发现技术取得了这些进步，但最先进的方法还不够，漏洞仍然存在。

当前技术不足的一个关键原因是嵌入式设备本身是由相互连接的组件组成的。这些组件是不同的二进制可执行文件，或者是大型嵌入式操作系统的不同模块，它们相互作用以完成各种任务。例如，嵌入式设备经常暴露由web服务器和各种后端应用程序组成的基于web的接口[6]，[44]。在这种架构中，任何给定的功能通常依赖于多个程序的执行\[12]:例如，接受HTTP请求的web服务器，由web服务器调用的本地二进制文件(例如，使用socket)，以及由本地二进制文件执行的外部命令来完成请求。

每个相互作用的固件组件(web服务器、后端应用程序和其他辅助程序)可以对共享的数据做出不同的假设，不一致性可能表现为安全漏洞。在固件样本的不同组件之间精确检测这些不安全的多二进制交互是具有挑战性的。孤立地考虑每个组件而不考虑内部数据流的程序分析方法会产生次优结果，因为它们(i)忽略了组件在二进制间通信过程中施加的有意义的约束，(ii)无法有效区分攻击者控制和非攻击者控制的输入源，以及(iii)可能只发现表面上的错误。

考虑一个接受用户凭证的web服务器，将其长度限制为16个字符，然后将它们传递给处理程序二进制(例如，通过环境变量)，该处理程序将它们复制到两个16字节长的缓冲区中。如果后一种二进制文件专门用于处理web服务器接收(和审查)的用户凭据，那么它可能会放弃长度检查的实现。在本例中，孤立地分析处理程序二进制可能会导致识别在实践中不可能触发的错误，并且安全性分析可能会产生大量误报，因为它必须假设二进制中的所有输入源都可能产生不受约束的攻击者控制的数据。这些误报需要由人工分析师进行检查，这代表了时间成本。由于分析人员检查、打补丁和测试固件样本所需的时间是不可忽略的，因此在实践中不构成安全威胁的二进制文件之间的受控交互应该被优先考虑。另一方面，仅考虑面向网络的二进制文件(即直接接受用户请求的二进制文件)的分析无法识别固件中更深层次和更复杂的错误。

因此，有效的固件分析必须考虑多个二进制文件，并对它们共享的数据进行推理。

不幸的是，大多数现有的程序分析工作一次只关注单个程序或模块[55]，[37]，[45]。虽然有些工作试图模拟嵌入式设备，从而同时分析所有组件，但目前的方法要么对固件样本施加严格的假设[11]，要么实现有限的成功率(即从13%[12]到21%[5])。其他方法[6]，[48]，[54]试图直接分析实际设备，但由于它们采用纯动态技术(例如，模糊测试)，它们可能无法发现更深层次和更复杂的漏洞[34]。

在本文中，我们介绍了KARONTE，这是一种新颖的静态分析方法，可以跟踪固件样本二进制文件中的数据流，以精确地发现安全漏洞。KARONTE基于二进制文件使用一组有限的进程间通信(IPC)范例进行通信的直觉，它利用这些范例中的共性来检测将用户输入引入固件示例的位置，并识别各种组件之间的交互。然后使用识别的交互来跟踪组件之间的数据流，并执行跨二进制污染分析。最后，使用传播的污点和约束来检测用户控制输入的不安全使用，这可能导致漏洞。

我们实现了KARONTE并使用两个数据集对其进行评估:53个当前版本固件样本和从相关工作中收集的899个样本[5]。我们利用以前的数据集来深入研究我们方法的每个阶段，并评估其有效性以发现错误。在我们的实验中，我们证明了我们的方法成功地识别了跨不同固件组件的数据流，正确地传播了污染信息。这使我们能够发现潜在的易受攻击的数据流，从而发现了46个零日漏洞，并重新发现了另外5个n天漏洞，证明了我们的方法在不同设计的复杂固件(即，单片嵌入式操作系统和嵌入式Linux发行版)上的有效性。毫无疑问，可靠的单二进制静态分析技术也可以发现这些漏洞，但它会产生大量的误报，从而使分析在现实世界中站不住脚。在我们比较KARONTE的多二进制分析方法和在单二进制模式下运行的相同分析(即禁用二进制间数据流跟踪)时，产生的警报数量从每个样本的平均2个增加到平均722个:KARONTE提供了两个数量级的警报减少和由此产生的低假阳性率。正如我们的评估中所示，我们估计验证由单二进制分析产生的所有警报可能需要安全分析师大约四个月的工作。另一方面，我们的原型生成的警报的验证累积时间大约为10小时。

最后，我们利用第二个更大的数据集来研究我们的工具的性能，显示其在不同大小和复杂性的固件样本上进行扩展的能力。

综上所述，我们做出了以下贡献:

- 我们介绍了静态分析技术的新组合来执行多二进制污染分析。为此，我们设计了一种新的技术，可以在多个二进制文件中精确地应用和传播污染信息。
- 我们提出KARONTE，一种新的静态分析方法来识别二进制文件之间的不安全交互。KARONTE从根本上减少了误报的数量，使现实世界的固件分析变得实用。
- 我们在53个真实固件样本上实现并评估了KARONTE原型，结果表明我们的工具可以成功地在多个二进制文件中传播污染信息，从而发现了46个未知(零日)bug，并产生了很少的误报。然后，我们利用899个固件样本的更大数据集来评估我们的工具的性能。
- 我们的工具得到的结果被另一所大学的独立研究人员彻底验证。

本着开放科学的精神，我们发布了我们的原型和docker映像的实现，以复制我们的工作环境: https://github:com/ucsb-seclab/karonte

## 2.背景
本节提供背景信息，以了解我们的方法的目标及其固有的挑战。

### A.物联网攻击者模型
物联网设备通过网络交换数据。这些数据可以直接来自用户(例如，通过web界面)，也可以间接来自受信任的远程服务(例如，云后端)。许多设备，特别是路由器、智能电表和许多低功耗设备，如智能灯泡和锁，都使用前一种模式。此外，最近的攻击表明，这些设备可以被聪明的远程攻击者利用，即使他们的通信被限制在一个封闭的本地网络中[23]。在这项工作中，我们考虑了直接通过本地网络或互联网与设备通信的基于网络的攻击者。然而，如第X节所示，KARONTE可以很容易地扩展到其他场景。

### B.固件复杂度
现代物联网设备的固件非常复杂，由多个组件组成。这些组件可以是不同的二进制文件(打包在嵌入式Linux发行版中)，也可以是不同的模块(编译成大型的单二进制嵌入式操作系统)(“blob固件”)。前一种类型的固件是目前最普遍的：一个大规模的实验分析了数以万计的固件样本，发现其中86%是基于linux的[11]。与其他基于linux的系统类似，基于linux的固件包含大量相互依赖的二进制文件。

嵌入式设备上固件的不同二进制文件(或组件)共享数据以执行设备的任务。在我们的攻击者模型下，这种交互是至关重要的，因为我们关注的是可能由攻击者从设备“外部”(即通过网络)输入触发的bug，但可能会影响直接面向网络的二进制文件以外的二进制文件。任何只关注这些面向网络的二进制文件的分析都会忽略其他组件中包含的错误[6]。另一方面，孤立地关注所有二进制文件的分析将产生不可接受的错误警报。

我们在以下基于真实固件示例的示例服务中演示了这一点。该服务由一个面向网络的web服务器(清单1)组成，该服务器执行CGI处理程序二进制文件(清单2)。当web服务器接收到用户请求时，它调用函数serve_request。然后，在解析请求(parse_URI)之后，web服务器执行处理程序，通过QUERY_STRING环境变量传递数据。处理程序二进制检索数据并将其传递给process_request。此函数包含一个bug:如果用户请求中的字段op的值大于128字节，则会发生缓冲区溢出。这种溢出是由攻击者控制的，代表了一个重大漏洞。

![](2020-SP-KARONTE-Detecting%20Insecure%20Multi-binary%20Interactions%20in%20Embedded%20Firmware.pdf/image-20231211095431700.png)

虽然这种特定的溢出将由只关注处理程序二进制的分析检测到，但任何单二进制分析都将检测到该程序中的两个漏洞。第二个问题是由LOG_PATH环境变量引起的log_dir缓冲区溢出。虽然这是一个合法的错误，但它的漏洞分类取决于LOG_PATH中数据的来源。如果攻击者无法控制这些数据，那么这个bug就不是漏洞，应该优先考虑真正的漏洞。理想情况下，每个警报都会被检查，每个bug都会被修复。不幸的是，这个目标在实践中是不可行的。虽然这个简单的例子有两个警报，揭示了一个漏洞，但我们的评估表明，对真实固件中的单个二进制文件进行静态分析可能会在每个设备上产生数千个警报，需要分析师数月的时间来处理。




## 参考文献

